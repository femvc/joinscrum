<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>JoinScrum haiyang</title>
    <style type="text/css">
    html {padding: 0px; margin: 0px;}
    body {padding: 0px; margin: 0px; font-family: Microsoft YaHei; }
    img {border: 0px;}
    a {border: 0px; color: green; }
    a:hover {color: #f60;}
    .clearfix {clear: both; font-size: 1px; height: 1px; line-height: 1px; margin-top: -1px; overflow: hidden;}
    .link { border:0px; color: #008000; display: inline; background-color: transparent; font-weight: bold; text-decoration: underline; cursor: pointer; padding: 0px 1px 0px 0px; }
    .link:hover { color: #FF6600; }
    .validate-text {color:red;}

    </style>

    <link rel="stylesheet" type="text/css" href="vm/m.css">
    <link rel="stylesheet" type="text/css" href="vm/taskboard.css">
    <link rel="stylesheet" type="text/css" href="vm/webclient.css">

    <link rel="stylesheet" type="text/css" href="vm/css/bootstrap-btn.css">
    <script type="text/javascript">
        'use strict';

        window.onload = function () {
            // Requester.get('/ue_api/internal/account/get_uid?rand=' + Math.random(), {
            //     onsuccess: function (result) {
            //         if (result && !result[0] && result[1]) {
            //             hui.g('uid').innerHTML = String(result[1]);
            //             hui.cc('link').style.display = 'block';
            //         }
            //     }
            // });

            // window.test_id = hui.util.getCookie('test_id');
            hui.context = new hui.BaseModel();
            
            initPageLogin();
            initPageIndex();
            initPageAddTask();
            initPageComment();

            hui.Template.parseTemplate(hui.g('history').innerHTML);

            hui.Action.start();
        };
        function showTab(tab, main) {
            hui.g('login'    ).style.display = 'none';
            hui.g('index'    ).style.display = 'none';
            hui.g('industry' ).style.display = 'none';
            hui.g('history'  ).style.display = 'none';
            

            main = main || tab;
            hui.g(main).style.display = 'block';
        }

        //-->
    </script>
</head>

<body style="" onload123="initForTest()">
    <!--.page>.page_head>.logo^+.page_banner>h1.test_title{你想知道自己前端技术实力排名吗？}+.test_desc{2014年，北京、上海、广州的互联网公司已超过30,000家，其中前端开发人员已超过100,000人，想知道你自己技术实力的排名吗}+.test_btn{立即测试}^+.page_foot{2014-10-17}-->
    <div class="page" style="width: 980px;">
        <div id="main" style="min-height: 750px;">
            <!-- Login -->
            <div class="page_body" id="login" style="display:none">
                <!-- target: login -->
                <style type="text/css">
                    div.loginboxtitle { font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; border: 1px solid #c0c0c0; margin-left: 70px; margin-right: 70px; padding-left: 11px; padding-right: 11px; width: 830px; }
                    div.loginboxtitle { background: #c0c0c0; font-size: 10pt; font-weight: bold; line-height: 21px; margin-top: 30px; margin-bottom: 0px; }
                    div.loginbox { font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; border: 1px solid #c0c0c0; margin-left: 70px; margin-right: 70px; padding-left: 11px; padding-right: 11px; width: 830px; }
                    div.loginbox { margin-top: 0px; font-size: 8pt; padding-top: 20px; color: #808080; }
                    div.logintable { margin-top: 20px; }
                    input { vertical-align: middle; }
                    table.center { display: inline; text-align: center; }
                    td.loginprompt { font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; text-align: right; color: #808080; font-size: 8pt; vertical-align: top; }
                    input.loginprompt { font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: #252525; font-size: 10pt; border: 1px solid; margin-bottom: 11px; }
                    .header { width: 970px; height: 61px; font-size: 8pt; display: block; background-image: url('vm/img/webclient-header.gif'); background-repeat: no-repeat; position: relative; top: 0px; left: 0px; color: white; margin-bottom: 12px; }
                    .header .headertext { position: absolute; bottom: 12px; left: 21px; color: white; }
                    .header a { text-decoration: underline; color: white; }
                </style>
                <div class="header">
                    <h1 class="header_title">JoinScrum</h1>
                    <div class="headertext">
                        <a href="#">Home</a> | <a href="#!/help" target="_blank">Help</a>
                    </div>
                </div>
                <div>
                    <div class="loginboxtitle" style="width:890px;margin-left:30px;">Web Client Login</div>
                    <div class="loginbox" style="width:890px;margin-left:30px;">
                        <div>
                            The JoinScrum provides a personalized view and limited updating of scrum data such as your task status and remaining hours.
                        </div>
                        <div class="logintable" style="line-height: 30px;">
                            <form method="post" action="/">
                                <!-- 搞笑，FF下table设置align="left" 居然有bug -->
                                <table cellspadding="5">
                                    <tr>
                                        <td valign="top">Username:</td>
                                        <td>
                                            <input type="text" value="andy" style="width: 120px;" ui="type:'TextInput',formname:'username',rule:'required'">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td valign="top">Password:</td>
                                        <td>
                                            <input type="password" value="aaa" style="width: 120px;" ui="type:'TextInput',formname:'password',rule:'required'">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>&nbsp;</td>
                                        <td>
                                            <button class="button" type="button" ui="type:'Button',formname:'login_submit'">Login</button>
                                        </td>
                                    </tr>
                                </table>
                                <br />
                                <br />
                            </form>
                        </div>
                    </div>
                </div>
                <div style="color: #AAAAAA; margin: 20px 20px 0px; padding-bottom:20px; text-align: center; width: 970px;">Copyright © 2015 JoinScrum, Inc. All rights reserved.</div>
            </div>
            <script>
                function initPageLogin() {
                    // pageLogin
                    var pageLogin;
                    pageLogin = function () {
                        hui.Action.call(this);
                        this.id = 'pageLogin';
                        this.main = 'login';

                        this.model = new hui.BaseModel({});
                        this.BACK_LOCATION = '/login';
                    };
                    pageLogin.prototype = {
                        /**
                         * @name 初始化列表行为
                         * @param {Object} controlMap 当前主内容区域绘制的控件集合.
                         */
                        initBehavior: function(controlMap) {
                            var me = this;
                            
                            if (me.querystring['logout']) {
                                Requester.get('/ue_api/internal/user_logout', {
                                    onsuccess: new Function()
                                });
                                
                                hui.context.set('mid', '');
                                hui.context.set('token', '');
                                hui.setCookie('token', '');
                            }
                            
                            var username = me.getByFormname('username');
                            var password = me.getByFormname('password');
                            var login_submit = me.getByFormname('login_submit');

                            if (username.getValue() == '' && hui.getCookie('mid')) {
                                 username.setValue(hui.getCookie('mid'));
                            }
                            
                            username.onenter = password.onenter = login_submit.onclick = function(){ me.onSubmit();};
                            
                        },
                        /**
                         * @name 初始化列表行为
                         * @param {Object} controlMap 当前主内容区域绘制的控件集合.
                         */
                        onSubmit: function(){
                            if (this.validate()) {
                                var me = this,
                                    username = me.getByFormname('username').getValue(),
                                    password = me.getByFormname('password').getValue();
                                
                                Requester.get('/ue_api/internal/user_login', {
                                    data: { 
                                        username: username,
                                        password: MD5.encode(password)
                                    },  
                                    onsuccess: hui.fn(me.loginCallback, me)
                                });
                            }
                        },
                        loginCallback: function(data){
                            var me = this,
                                result = data ? data[1] : [];
                            if (!data[0] && result.mid) {
                                
                                hui.context.set('mid', result['mid']);
                                hui.context.set('token', result['token']);
                                hui.setCookie('mid', result['mid']);
                                hui.setCookie('token', result['token']);

                                if (hui.Locator.currentLocation.indexOf('/login') == 0) {
                                    hui.setCookie('taskboard_user', result['mid']);
                                    //  hui.Locator.redirect('/');
                                    window.location.href = '#!/';
                                }
                                else {
                                    // hui.Locator.reload();
                                    window.location.reload();
                                }
                            }
                            else {
                                me.getByFormname('username').showError(data[0].mobile);
                            }
                        },
                        finish: function () {
                            var me = this;
                            showTab('login');
                        }
                    };

                    hui.inherits(pageLogin, hui.Action);
                    hui.Router.setRule('/login', 'pageLogin');
                    hui.window.pageLogin = pageLogin;
                }
            </script>
            <div class="page_body" id="index" style="display: none;">
                <!-- target: taskboard_layout -->
                <style type="text/css">
                    .content { margin-left: 20px; margin-right: 20px; }
                    #needsUpdate { cursor: pointer; /* see: http://www.mandarindesign.com/opacity.html */; opacity: .85; filter: alpha(opacity=85); position: absolute; left: 57px; /* centered in the taskboard table: left margin + half of the diff between the table width and the image width */; z-index: 9999; }
                    .error { font-size: 8pt; font-weight: bold; color: black; padding-left: 8px; margin-bottom: 12px; }
                    .sectionHeader.nextSection { margin-top: 40px; }
                    .sectionHeader { width: 930px; font-size: 12pt; color: white; text-align: left; background: transparent; margin-bottom: 12px; line-height: 21px; /* using line-height so that the text is vertically centered. */ }
                    .sectionHeader_table { border-collapse: collapse; border-spacing: 0; width: 100%; margin: 0px; padding: 0px; }
                    .sectionHeader_w { width: 2px; height: 28px; background: url('vm/img/taskboard-header-left.gif') no-repeat 0 0; }
                    .sectionHeader_n { height: 28px; background: url('vm/img/taskboard-header-slice.gif') repeat-x 0 0; }
                    .sectionHeaderText { color: white; margin-left: 5px; }
                    .sectionHeader_e { width: 4px; height: 28px; background: url('vm/img/taskboard-header-right.gif') no-repeat 0 0; }
                    .burndownChart { margin-top: 20px; }
                    #burndownImg { border-width: 0px; padding-left: 8px; height: 480px; }
                    #newImpediment { margin-bottom: 10px; }
                    #impedimentsTable { border: none; font-size: 9pt; width: 900px; }
                    col#entered { width: 100px; }
                    col#lastmodified { width: 100px; }
                    col#title { width: 200px; }
                    col#description { width: 350px; }
                    col#reporter { width: 150px; }
                    th.impedimentattribute { font-size: 9pt; color: black; font-weight: bold; text-align: left; border: none; padding-bottom: 12px; padding-left: 8px; }
                    .header { width: 970px; height: 61px; font-size: 8pt; display: block; background-image: url('vm/img/webclient-header.gif'); background-repeat: no-repeat; position: relative; top: 0px; left: 0px; color: white; margin-bottom: 12px; }
                    .header .headertext { position: absolute; bottom: 12px; left: 21px; color: white; }
                    .header a { text-decoration: underline; color: white; }
                </style>

                <div class="header">
                    <h1 class="header_title">JoinScrum</h1>
                    <div class="headertext">
                        Welcome: <span id="welcome_user">andy.wang</span>
                        <span style="padding-left: 20px; font-size: 8pt;">
                            <a href="#!/login~logout=true">Log out</a> |
                            <a href="#">Home</a> |
                            <a href="#!/help" target="_blank">Help</a>
                        </span>
                    </div>
                </div>
                <div class="content">
                    <div id="needsUpdate" style="display: none;">
                        <img src="vm/img/refresh_alert_final.gif" alt="Changes have been made to this page by another User. Click this message to update display." onclick="window.location.reload();//hui.Locator.reload();" />
                    </div>
                    <div class="error" id="noSprints" style="display: none">
                        There are no sprints in the selected product.
                    </div>
                    <div class="error" id="noPbis" style="display: none">
                        There are no backlog items in this sprint.
                    </div>
                    <div class="error" id="noTaskAccess" style="display: none">
                        You don&#39;t have access to view any tasks for this product.
                    </div>

                    <div id="selectors">
                        <table class="selectors">
                            <tr>
                                <td>
                                    <span>View Product:</span>
                                    <button class="link" style="margin-left: 0px;" onclick="hui.Master.get().addProduct()">add</button><i>/</i>
                                    <button class="link" style="margin-left:0px;" onclick="hui.Master.get().editProduct()">edit</button>
                                </td>
                            </tr>
                            <tr>
                                <td width="170">
                                    <div ui="type:'Dropdown',formname:'product_list',data_value:'product_id',data_text:'product_name',default_select:true" style="width:150px;"></div>
                                </td>
                                <td width="200">
                                    Sprint: <button class="link" style="" onclick="hui.Master.get().addSprint()">add </button>
                                </td>
                                <td width="200">
                                    <input id="include_deleted" name="include_deleted" type="checkbox" onclick="hui.setCookie('include_deleted', String(this.checked));hui.Master.get().switchProduct()" />
                                <label for="include_deleted">Show deleted task</label>
                                </td>
                                <td>
                                    <div ui="type:'Dropdown',formname:'user_list',data_value:'uid',data_text:'user_label'" style="width:230px; float: right;">
                                        <!--option value="Aaron.lu (aaron.lu)">Aaron.lu (aaron.lu)</option-->
                                    </div>
                                    <label style="float: right;margin-top: 5px;margin-right: 10px;">Highlight Tasks</label>
                                </td>
                            </tr>
                        </table>
                    </div>


                    <div class="">
                        <h3>Taskboard: All Tasks</h3>
                        <div id="taskboard" ui="type:'Panel',formname:'taskboard'"></div>
                    </div>


                    <div class="error" id="noBurndown" style="display: none">
                        You either do not have permission to view tasks or there are no sprints for this product.
                    </div>

                </div>
                <br /><br />
                <hr style="  border: 1px solid #eee;" />
                <div style="color: #AAAAAA; margin: 20px 20px 0px; padding-bottom:20px; text-align: center; width: 970px;">Copyright &copy; 2015 JoinScrum, Inc. All rights reserved.</div>
            </div>
            <script>
                function initPageIndex() {
                    // pageTaskboard
                    var pageTaskboard;
                    pageTaskboard = function () {
                        hui.Action.call(this);
                        /**
                         * @name Action索引ID
                         * @comment 主要用于控件中通过onclick="hui.Control.getById('listTable','login');
                         */
                        this.id = 'taskboard';
                        // this.view = 'taskboard_layout';
                        this.BACK_LOCATION = '/login';
                        this.main = 'index';
                    };
                    pageTaskboard.prototype = {
                        initModel: function(callback){
                            var me = this;
                            //me.getSprintData(callback);

                            callback&&callback();
                        },
                        getSprintData: function (callback) {
                            var me = this;
                            Requester.get('/ue_api/internal/user_list', {
                                onsuccess: function (data) {
                                    me.model.set('user_list'   , _.sortBy(data[1].items, '_id').reverse());
                                    me.getSprintDataCallback(callback);
                                }
                            });
                            Requester.get('/ue_api/internal/product_list', {
                                onsuccess: function (data) {
                                    me.model.set('product_list'   , _.sortBy(data[1].items, 'product_index').reverse());
                                    me.getSprintDataCallback(callback);
                                }
                            });
                            
                        },
                        getSprintDataCallback: function (callback) {
                            var me = this;
                            if (me.model.get('user_list') && me.model.get('product_list')) {
                                callback&&callback();
                                //this.getTaskData(callback)
                            }
                        },
                        initBehavior: function(controlMap) {
                            var me = this;
                            
                            // hui.Master.get().controlMap.vModal2.show();
                            // me.controlMap.submit.onclick = hui.fn(me.onSubmit, me);
                              

                        },
                        finish: function () {
                            var me = this;
                            showTab('index');

                            if (hui.getCookie('include_deleted') === 'true') {
                                hui.g('include_deleted').checked = 'checked';
                            }
                            
                            me.getSprintData(function(){
                                var productList = hui.Control.getByFormname('product_list');
                                productList.setOptions(me.model.get('product_list'));
                                productList.setValue(hui.getCookie('taskboard_product'));
                                productList.onchange = hui.fn(me.switchProduct, me);
                                
                                var userList    = hui.Control.getByFormname('user_list' );
                                userList.setOptions(me.getUserList());
                                userList.setValue(hui.getCookie('taskboard_user'));
                                userList.onassignvalue = userList.onchange    = hui.fn(me.switchUser, me);  
                                
                                me.switchProduct();

                                hui.g('welcome_user').innerHTML = me.getUserItem(hui.getCookie('mid')).username;
                                
                            });
                            //me.switchProduct();
                            
                            hui.setCookie('task_lastmodify', ''); 
                            me.checkTaskModify();
                        },
                        switchUser: function () {
                            var me = this;
                            me.highlightTask();
                        },
                        switchProduct: function(){
                            var me = this;
                            var product_id = hui.Control.getByFormname('product_list').getValue();
                            hui.setCookie('taskboard_product', product_id);

                            me.model.remove('sprint_list');
                            me.model.remove('backlog_list');
                            me.model.remove('task_list');
                            me.model.remove('taskindex_list');

                            Requester.get('/ue_api/internal/sprint_list?product_id=' + product_id, {
                                onsuccess: function (data) {
                                    me.model.set('sprint_list'   , _.sortBy(data[1].items, 'sprint_index'));
                                    me.switchProductCallback();
                                }
                            });
                            Requester.get('/ue_api/internal/backlog_list?product_id='+product_id, {
                                onsuccess: function (data) {
                                    me.model.set('backlog_list'   , _.sortBy(data[1].items, 'backlog_index'));
                                    me.switchProductCallback();
                                }
                            });
                            var include_deleted = hui.getCookie('include_deleted') === 'true' ? '' : '&task_deleted=0';
                            Requester.get('/ue_api/internal/task_list?product_id='+ product_id + include_deleted, {
                                onsuccess: function (data) {
                                    //me.model.set('task_list'   , _.sortBy(data[1].items, 'task_index').reverse());
                                    me.model.set('task_list'   , data[1].items);
                                    me.switchProductCallback();
                                }
                            });
                            
                            Requester.get('/ue_api/internal/taskindex_list?product_id=' + product_id, {
                                onsuccess: function (data) {
                                    //me.model.set('task_list'   , _.sortBy(data[1].items, 'task_index').reverse());
                                    me.model.set('taskindex_list'   , data[1].items);
                                    me.switchProductCallback();
                                }
                            });
                            
                        },
                        switchProductCallback: function (sprint_id) {
                            var me = this,
                                task_list;
                            if (me.model.get('sprint_list') && me.model.get('backlog_list') && me.model.get('task_list') && me.model.get('taskindex_list')) { //

                                hui.Control.getByFormname('taskboard').disposeChild();

                                                              
                                
                                var product_id = hui.Control.getByFormname('product_list').getValue();
                                var sprint_list = _.filter(me.model.get('sprint_list'), function(item){
                                        return item.product_id == product_id
                                    });
                                for (var i=0,len=sprint_list.length; i<len; i++) {
                                    var taskboard = hui.Control.create('Taskboard', {
                                            formname:'taskboard' + sprint_list[i].sprint_id, 
                                            sprint_id: sprint_list[i].sprint_id, 
                                            sprint_data: sprint_list[i],
                                            parentElement: document.getElementById('taskboard')
                                        });
                                    
                                    taskboard.taskList = me.sortTask(sprint_list[i].sprint_id); 
                                    me.repaintTaskboard(taskboard);
                                    // me.repaintBurden(sprint_list[i].sprint_id);

                                    var memberload = hui.Control.create('Burndown', {
                                        formname:'burndown', 
                                        parentElement: document.getElementById('taskboard'),
                                        sprint_id: sprint_list[i].sprint_id,
                                        product_id: product_id
                                    });
                                }

                                var datasource = {}; //{'sprint01': {'user01': 20, 'user02': 30},'sprint02': {'user01': 10, 'user02': 10}};
                                var member = [];
                                var taskList = me.model.get('task_list');
                                for (var i=0,len=taskList.length; i<len; i++) {
                                    var item = taskList[i];
                                    datasource[item.sprint_id] = datasource[item.sprint_id] || {};
                                    datasource[item.sprint_id][item.task_person] = datasource[item.sprint_id][item.task_person] || 0;
                                    datasource[item.sprint_id][item.task_person] += Number(item.task_remaining);
                                    member.push(item.task_person);
                                }
                                member = _.uniq(member).sort().reverse();

                                var hours = [];
                                // [{
                                //     name: 'wechat',
                                //     data: [5, 3, 4, 7, 2, 2, 3, 4, 7, 2, 2, 3, 4, 7, 2, 2, 3, 4, 7, 2, 2]
                                // }, {
                                //     name: 'search',
                                //     data: [2, 2, 3, 2, 1]
                                // }]  
                                var colors = ['#FF9900','#99CC00','#CC9900','#99CC00','#0099CC','#00CC99','#CC5599','#FE8463','#9BCA63','#FAD860','#F3A43B','#60C0DD','#D7504B','#C6E579','#F4E001','#F0805A','#26C0C0'];
                                var barcolor;
                                var lefthours;
                                for (var i in datasource) {
                                    barcolor = colors.shift();
                                    colors.push(barcolor);
                                    lefthours = {name: me.getSprintItem(i).sprint_name, data: [], color: barcolor}; 
                                    for (var j=0,len2=member.length; j<len2; j++) {
                                        lefthours.data.push(datasource[i][member[j]] || 0);
                                    }
                                    hours.push(lefthours);
                                }
                                var username = [];
                                var user;
                                for (var j=0,len2=member.length; j<len2; j++) {
                                    user = me.getUserItem(member[j]) || {};
                                    username.push(user.realname + '(' + user.username + ')');
                                }

                                var memberload = hui.Control.create('Memberload', {
                                        formname:'memberload', 
                                        parentElement: document.getElementById('taskboard'),
                                        member: username,
                                        hours: hours
                                    });

                            }
                        },
                        sortTask: function (sprint_id) {
                            var me = this,
                                task_list = _.filter(me.model.get('task_list'), function(a){ return a.sprint_id == sprint_id; }),
                                taskindex_list = _.filter(me.model.get('taskindex_list'), function(a){ return a.sprint_id == sprint_id; }),
                                taskList = {},
                                item,
                                index = 1;
                            for (var i=0,len=taskindex_list.length; i<len; i++) {
                                item = taskindex_list[i].taskindex;
                                for (var j=0,len2=item.length; j<len2; j++) {
                                    if (!taskList[item[j]]) {
                                        taskList[item[j]] = index++;
                                    }
                                }
                            }
                            for (var i=0,len=task_list.length; i<len; i++) {
                                task_list[i].task_index = taskList[task_list[i].task_id];
                            }
                            
                            return _.sortBy(task_list, 'task_index').reverse();
                        },
                        getUserList: function () {
                            var me = this,
                                list = me.model.get('user_list');
                            for (var i=0,len=list.length; i<len; i++) {
                                list[i].user_label = (list[i].realname !== undefined ? list[i].realname : list[i].username) + ' (' + list[i].username + ')';
                            }
                            return list;        
                        },
                        getUserItem: function (id) {
                            var me = this,
                                list = me.model.get('user_list'),
                                item = null;
                            id = id === '' ? 'unspecified' : id;
                            
                            for (var i=0,len=list.length; i<len; i++) {
                                if (list[i].uid == id) {
                                    item = list[i];
                                    break;
                                }
                            }
                            return item;        
                        },
                        getDataItem: function (n, id) {
                            var me = this,
                                list = me.model.get(n + '_list'),
                                item = null;
                            for (var i=0,len=list.length; i<len; i++) {
                                if (list[i][n + '_id'] === id) {
                                    item = list[i];
                                    break;
                                }
                            }
                            return item;        
                        },
                        getProduct: function (id) {
                            return this.getDataItem('product', id);        
                        },
                        getSprintItem: function (id) {
                            return this.getDataItem('sprint', id);      
                        },
                        getBacklogItem: function (id) {
                            return this.getDataItem('backlog', id);    
                        },
                        getTaskItem: function (id) {
                            return this.getDataItem('task', id); 
                        },
                        /**
                         * @name 新增backlog
                         * @public
                         */
                        addBacklog: function (sprint_id) {
                            this.editBacklog(sprint_id);
                        },
                        /**
                         * @name 修改backlog
                         * @public
                         * @param {string} [backlog_id] 
                         */
                        editBacklog: function (sprint_id, backlog_id) {
                            var me = this,
                                nc = hui.Control.getById('editBacklog', me),
                                backlogValue,
                                backlogItem;
                            
                            // 确定backlogItem的值
                            backlogValue = {sprint_id: sprint_id};
                            if (backlog_id) {
                                backlogItem = me.getBacklogItem(backlog_id);
                                if (backlogItem) {
                                    backlogValue.backlog_id     = backlogItem.backlog_id;
                                    backlogValue.backlog_name   = backlogItem.backlog_name;   
                                    backlogValue.backlog_desc   = backlogItem.backlog_desc;
                                    backlogValue.backlog_index  = backlogItem.backlog_index;  
                                    backlogValue.sprint_id      = backlogItem.sprint_id;      
                                }
                            }
                            backlogValue.sprint_name = me.getSprintItem(backlogValue.sprint_id).sprint_name;
                            // 弹出对话框
                            if (nc) {
                                nc.dispose();
                            }
                            nc = hui.Control.create('Boxpanel', {
                                id: 'editBacklog', 
                                title: backlog_id ? ' Edit Backlog' : ' Add Backlog', 
                                contentView: 'taskboard_addbacklog', 
                                size: { width:'500px', height: '340px', bottom: '8%'}
                            });
                            this.appendControl(nc);
                            // 绑定事件
                            nc.getByFormname('submit').onclick = new Function('hui.Master.get().saveBacklog(\''+backlogValue.sprint_id+'\', \''+backlog_id+'\')');
                            
                            nc.setValueByTree(backlogValue);
                            nc.show();
                        },
                        saveBacklog: function (sprint_id, backlog_id) {
                            var me = this;
                            var nc = hui.Control.getById('editBacklog', me),
                                taskboard = hui.Control.getByFormname('taskboard'+sprint_id);
                            
                            if (nc && nc.validate()) {
                                var backlogValue = nc.getParamMap();
                                backlogValue.product_id = me.getSprintItem(sprint_id).product_id;
                                
                                Requester.get('/ue_api/internal/backlog_save', {
                                    data: backlogValue,
                                    onsuccess: hui.fn(me.saveBacklogCallback, me)
                                });
                            }
                        },
                        saveBacklogCallback: function (data) {
                            var me = this;
                            if (!data[0] && data[1]) {
                                // 销毁对话框
                                hui.Control.getById('editBacklog', me).dispose();
                                
                                // me.switchSprint(); 
                                window.location.reload();
                            }
                        },
                        repaintTaskboard: function (taskboard) {
                            var me = this;
                            //var taskboard = hui.Control.getByFormname('taskboard');
                            taskboard.removeBacklogRow('all');
                            
                            taskboard.product_key = me.getProduct(hui.Control.getByFormname('product_list').getValue()).product_key;
                            taskboard.backlogList = _.filter(me.model.get('backlog_list'), function(a){
                                return a.sprint_id == taskboard.sprint_id});
                            
                            taskboard.setBacklogList();
                            taskboard.setTaskList();

                            me.highlightTask();                            
                            
                        },
                        
                        /**
                         * @name 操作task
                         * @public
                         */
                        takeTask: function (task_id) {
                            var me = this,
                                uid = hui.Control.getByFormname('user_list').getValue(),
                                taskItem = me.getTaskItem(task_id);
                            taskItem.task_person    = uid;
                            taskItem.task_deleted   = '0';
                            
                            me.saveTask(taskItem);
                        },
                        moveTask: function (task) {
                            var me = this,
                                task_id = task.elem.id.split('_')[1],
                                str = task.elem.parentNode.id.split('_'),
                                taskItem = me.getTaskItem(task_id);
                            taskItem.task_status    = str[0];
                            taskItem.backlog_id     = str[1];
                            taskItem.task_remaining = taskItem.task_status == 'done' ? 0 : taskItem.task_remaining;
                            taskItem.task_deleted   = '0';
                            
                            me.saveTask(taskItem);
                        },
                        deleteTask: function (task_id) {
                            var me = this,
                                uid = hui.Control.getByFormname('user_list').getValue(),
                                taskItem = me.getTaskItem(task_id);
                            taskItem.task_deleted   = 'deleted';
                            
                            me.saveTask(taskItem);
                        },
                        /**
                         * @name 新增task
                         * @public
                         */
                        addTask: function(backlog_id) {
                            var me = this,
                                users = me.model.get('user_list'),
                                taskItem = {};
                            var sprint_id = _.find(me.model.get('backlog_list'), function(a){return a.backlog_id == backlog_id}).sprint_id;
                            taskItem.sprint_id  = sprint_id;
                            taskItem.backlog_id = backlog_id;
                            //alert(objId);
                            me.editTask(sprint_id, taskItem);
                        },
                        /**
                         * @name 修改task
                         * @public
                         * @param {string} [task_id] 
                         */
                        editTask: function (sprint_id, taskItem) {
                            var me = this;
                            
                            taskItem = !taskItem.sprint_id ? me.getTaskItem(taskItem) : taskItem;
                            
                            var nc = hui.Control.getById('editTask', me);
                            if (nc) {
                                nc.dispose();
                            }
                            
                            // 弹出对话框
                            nc = hui.Control.create('Boxpanel', {
                                id: 'editTask', 
                                title: '',  
                                contentView: 'taskboard_addtask', 
                                size: { width:'750px', height: '500px', bottom: '8%'}
                            });
                            this.appendControl(nc);
                            // 绑定事件
                            nc.getByFormname('submit').onclick = new Function('hui.Master.get().saveTask()');
                            
                            // nc.setTitle(taskItem.task_name ? ' Edit Task - ' + taskItem.task_name + '' : 
                            //             ' Add Task to - ' + me.getBacklogItem(taskItem.backlog_id).backlog_name + '');
                            // 必须先初始化options，否则task_person无法setValue!!
                            nc.getByFormname('task_person').setOptions(me.getUserList());
                            nc.getByFormname('task_person').setValue(hui.getCookie('taskboard_user'));
                            // 默认解除deleted状态
                            taskItem.task_deleted = '0';
                            taskItem.backlog_name = me.getBacklogItem(taskItem.backlog_id).backlog_name;
                            nc.setValueByTree(taskItem);
                            nc.show();
                            
                        },
                        saveTask: function (taskValue) {
                            var me = this;
                            
                            if (!taskValue) {
                                var nc = hui.Control.getById('editTask', me);
                                taskValue =  nc && nc.validate() ? nc.getParamMap() : null;
                            }
                            
                            if (taskValue) {
                                // taskValue.backlog_id = Number(taskValue.backlog_id);
                                
                                if (!hui.util.isEqual(taskValue, me.getTaskItem(taskValue.task_id))) {
                                    // 自己修改的，无需显示刷新提示
                                    hui.setCookie('task_lastmodify', '');
                                    taskValue.product_id = me.getSprintItem(taskValue.sprint_id).product_id;
                                    
                                    Requester.get('/ue_api/internal/task_save', {
                                        data: taskValue,
                                        onsuccess: hui.fn(me.saveTaskCallback, me)
                                    });
                                }
                                // 保存任务上下次序
                                if (taskValue.task_id) {
                                    me.saveTaskIndex(taskValue);
                                }
                            }
                        },
                        saveTaskCallback: function (data) {
                            var me = this;
                            if (!data[0] && data[1]) {
                                var taskboard = hui.Control.getByFormname('taskboard'+data[1].sprint_id),
                                    list = me.model.get('task_list'),
                                    isAdd = true,
                                    taskValue = data[1];
                                // 注：更新task_list
                                for (var i=0,len=list.length; i<len; i++) {
                                    if (list[i].task_id === taskValue.task_id) {
                                        list[i] = taskValue;
                                        isAdd = false; 
                                        list[i].task_deleted === 'deleted' && list.splice(i, 1);
                                        break;
                                    }
                                }
                                isAdd && list.push(taskValue);
                                
                                //me.model.set('task_list'   , _.sortBy(list, 'task_index'));
                                me.model.set('task_list'   , list);
                                
                                // 添加到任务板上
                                if (String(taskValue.task_deleted) === 'deleted') {
                                    taskboard.deleteTask(taskValue);
                                }
                                else if (hui.g('task_'+taskValue.task_id)) {
                                    taskboard.updateTask(taskValue);
                                    hui.removeClass(hui.g('task_'+taskValue.task_id), 'deleted');
                                }
                                else {
                                    taskboard.addTaskRow(taskValue);
                                }
                                
                                // 销毁对话框
                                var editTask = hui.Control.getById('editTask', me);
                                editTask&&editTask.dispose();
                                hui.Mask.hide();
                                
                                // 高亮任务
                                me.highlightTask();
                                
                                // 新增任务需保存上下次序
                                isAdd && me.saveTaskIndex(taskValue);

                                // 任务负载情况
                                me.switchProduct();
                            }
                        },
                        saveTaskIndex: function (taskValue) {
                            var me = this,
                                task_id = taskValue.task_id,
                                backlogItem = hui.g('task_' + task_id).parentNode,
                                str = backlogItem.id.split('_'),
                                task_status = str[0],
                                backlog_id = str[1],
                                list = backlogItem.childNodes,
                                taskindex = [];
                            for (var i=0,len=list.length; i<len; i++) {
                                if (list[i] && list[i].className && (' ' + list[i].className + ' ').indexOf(' task ') != -1) {
                                    taskindex.push(list[i].id.split('_')[1]);
                                }
                            }
                            
                            Requester.get('/ue_api/internal/taskindex_save', {
                                data: { 
                                    backlog_id: backlog_id,
                                    task_status: task_status,
                                    sprint_id: me.getBacklogItem(backlog_id).sprint_id,
                                    product_id: me.getSprintItem(me.getBacklogItem(backlog_id).sprint_id).product_id,
                                    taskindex: JSON.stringify(taskindex)
                                },  
                                onsuccess: new Function()
                            });

                        },
                        highlightTask: function () {
                            var me = this,
                                uid = hui.Control.getByFormname('user_list').getValue(),
                                list = hui.c('task'),
                                task_person;
                            for (var i=0,len=list.length; i<len; i++) {
                                task_person = hui.c('pointperson', list[i])[0];
                                if (task_person && task_person.getAttribute('task_person') == uid) {
                                    hui.addClass(list[i], 'taskofuser0');
                                }
                                else {
                                    hui.removeClass(list[i], 'taskofuser0');
                                }
                            }
                            
                            uid && hui.setCookie('taskboard_user', uid);
                            
                        },
                        checkTaskModify: function () {
                            var me = this;
                            return;
                            Requester.get('/ue_api/internal/task_lastmodify?rand=' + Math.random(), {
                                onsuccess: hui.fn(me.checkTaskModifyCallback, me)
                            });
                        },
                        checkTaskModifyCallback: function (data) {
                            var me = this,
                                task_lastmodify = String(hui.getCookie('task_lastmodify')),
                                last_log = data[1][0] ? data[1][0] : {_id: '0'};
                            
                            if (task_lastmodify && task_lastmodify !== String(last_log._id)) {
                                hui.g('needsUpdate').style.display = 'block';
                            }
                            else {            
                                hui.setCookie('task_lastmodify', last_log._id);
                                
                                me.checkTaskModifyTimer = window.setTimeout(function(){me.checkTaskModify();}, 30000);
                            }
                            
                        },
                        /**
                         * @name 修改Product
                         * @public
                         * @param {string} [product_id] 
                         */
                        addProduct: function () {
                            this.editProduct('new');
                        },
                        editProduct: function (isNew) {
                            var me = this,
                                nc = hui.Control.getById('editProduct', me),
                                product_id = hui.Control.getByFormname('product_list').getValue(),
                                productValue,
                                productItem;
                            
                            // 确定productItem的值
                            productValue = {};
                            if (isNew != 'new') {
                                productItem = me.getProduct(product_id);
                                if (productItem) {
                                    productValue.product_id     = productItem.product_id;
                                    productValue.product_name   = productItem.product_name;   
                                    productValue.product_key    = productItem.product_key;    
                                    productValue.product_index  = productItem.product_index;      
                                }
                            }
                            // 弹出对话框
                            if (nc) {
                                nc.dispose();
                            }
                            nc = hui.Control.create('Boxpanel', {
                                id: 'editProduct', 
                                title: product_id ? ' Edit Product' : ' Add Product', 
                                contentView: 'taskboard_addproduct', 
                                size: { width:'500px', height: '340px', bottom: '8%'}
                            });
                            this.appendControl(nc);
                            // 绑定事件
                            nc.getByFormname('submit').onclick = new Function('hui.Master.get().saveProduct()');
                            
                            nc.setValueByTree(productValue);
                            nc.show();
                        },
                        saveProduct: function () {
                            var me = this;
                            var nc = hui.Control.getById('editProduct', me);
                            
                            if (nc && nc.validate()) {
                                var productValue = nc.getParamMap();
                                
                                Requester.get('/ue_api/internal/product_save', {
                                    data: productValue,
                                    onsuccess: hui.fn(me.saveProductCallback, me)
                                });
                            }
                        },
                        saveProductCallback: function (data) {
                            var me = this;
                            if (!data[0] && data[1]) {
                                // 销毁对话框
                                hui.Control.getById('editProduct', me).dispose();
                                
                                // hui.setCookie('taskboard_product', data[1][0].product_id);
                                // hui.Locator.reload();
                                window.location.reload();
                            }
                        },
                        /**
                         * @name 修改Sprint
                         * @public
                         * @param {string} [sprint_id] 
                         */
                        addSprint: function () {
                            this.editSprint('', 'new');
                        },
                        editSprint: function (sprint_id, isNew) {
                            var me = this,
                                nc = hui.Control.getById('editSprint', me),
                                product_id = hui.Control.getByFormname('product_list').getValue(),
                                sprintValue,
                                sprintItem;
                            
                            // 确定sprintItem的值
                            sprintValue = {product_id: product_id};
                            if (isNew != 'new') {
                                sprintItem = me.getSprintItem(sprint_id);
                                if (sprintItem) {
                                    sprintValue.sprint_id     = sprintItem.sprint_id;
                                    sprintValue.sprint_name   = sprintItem.sprint_name;   
                                    sprintValue.sprint_desc   = sprintItem.sprint_desc;  
                                    sprintValue.sprint_index  = sprintItem.sprint_index; 
                                    sprintValue.product_id    = sprintItem.product_id;      
                                }
                            }
                            // 弹出对话框
                            if (nc) {
                                nc.dispose();
                            }
                            nc = hui.Control.create('Boxpanel', {
                                id: 'editSprint', 
                                title: sprint_id ? ' Edit Sprint' : ' Add Sprint', 
                                contentView: 'taskboard_addsprint', 
                                size: { width:'500px', height: '340px', bottom: '8%'}
                            });
                            this.appendControl(nc);
                            // 绑定事件
                            nc.getByFormname('submit').onclick = new Function('hui.Master.get().saveSprint()');
                            
                            nc.setValueByTree(sprintValue);
                            nc.show();
                        },
                        saveSprint: function () {
                            var me = this;
                            var nc = hui.Control.getById('editSprint', me);
                            
                            if (nc && nc.validate()) {
                                var sprintValue = nc.getParamMap();
                                
                                Requester.get('/ue_api/internal/sprint_save', {
                                    data: sprintValue,
                                    onsuccess: hui.fn(me.saveSprintCallback, me)
                                });
                            }
                        },
                        saveSprintCallback: function (data) {
                            var me = this;
                            if (!data[0] && data[1]) {
                                // 销毁对话框
                                hui.Control.getById('editSprint', me).dispose();
                                
                                // hui.setCookie('selected_sprint', data[1][0].sprint_id);
                                // hui.Locator.reload();
                                window.location.reload();
                            }
                        }
                    };

                    hui.inherits(pageTaskboard, hui.Action);
                    hui.Router.setRule('/', 'pageTaskboard');
                    hui.window.pageTaskboard = pageTaskboard;

                    hui.Locator.addFilter('/', function(next, finish){
                        if (!hui.getCookie('mid')) {
                            // window.location.href = '#!/login';
                            hui.Locator.redirect('#!/login');
                        }
                        else {
                            next();
                        }
                        
                    })
                }
            </script>
            <div class="page_body" id="history" style="background-color: white;display: none;">
                <!-- target: taskboard_addsprint -->
                <table>
                    <tr>
                        <td align="right" valign="top"> </td>
                        <td align="left" valign="top" colspan="3"><h3>Add Sprint</h3></td>
                    </tr>
                    <tr>
                        <td align="right" valign="top">Sprint Name:</td>
                        <td>
                            <input type="hidden" ui="type:'TextInput',formname:'product_id'" />
                            <input type="hidden" ui="type:'TextInput',formname:'sprint_id'" />
                            <input type="text" size="30" ui="type:'TextInput',formname:'sprint_name',rule:'required'" />
                        </td>
                    </tr>
                    <tr>
                        <td class="inputLabel" style="vertical-align: top;">Description:</td>
                        <td style="vertical-align: top;">
                            <textarea ui="type:'TextInput',formname:'sprint_desc'" cols="40" rows="9"></textarea>
                        </td>
                    </tr>
                    <tr>
                        <td class="inputLabel" style="vertical-align: top;">Index:</td>
                        <td style="vertical-align: top;">
                            <input type="text" size="16" ui="type:'TextInput',formname:'sprint_index'" />
                        </td>
                    </tr>
                    <tr>
                        <td align="right" valign="top"> </td>
                        <td height="40" valign="bottom">
                            <button ui="type:'Button',formname:'submit'">提交</button>
                        </td>
                    </tr>
               </table>

                <!-- target: taskboard_addproduct -->
                <table>
                    <tr>
                        <td align="right" valign="top"> </td>
                        <td align="left" valign="top" colspan="3"><h3>Add Product</h3></td>
                    </tr>
                    <tr>
                        <td align="right" valign="top">Name:</td>
                        <td>
                            <input type="hidden" ui="type:'TextInput',formname:'product_id'" />
                            <input type="text" size="30" ui="type:'TextInput',formname:'product_name',rule:'required'" />
                        </td>
                        <td rowspan="6" style="vertical-align: top; padding-left:20px;">

                        </td>
                    </tr>
                    <tr>
                        <td class="inputLabel" style="vertical-align: top;">Description:</td>
                        <td style="vertical-align: top;">
                            <textarea ui="type:'TextInput',formname:'product_desc'" cols="40" rows="9"></textarea>
                        </td>
                    </tr>
                    <tr>
                        <td align="right" valign="top">Keyword :</td>
                        <td>
                            <input type="text" size="13" ui="type:'TextInput',formname:'product_key',rule:'required'" /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Index:
                            <input type="text" size="13" ui="type:'TextInput',formname:'product_index'" />
                        </td>
                    </tr>
                    <tr>
                        <td align="right" valign="top"> </td>
                        <td height="40" valign="bottom">
                            <button ui="type:'Button',formname:'submit'">提交</button>
                        </td>
                    </tr>
                    
                </table>

                <!-- target: taskboard_addbacklog -->
                <table>
                    <tr>
                        <td align="right" valign="top"> </td>
                        <td align="left" valign="top" colspan="3"><h3>Add Backlog</h3></td>
                    </tr>
                    <tr>
                        <td align="right" valign="top">Title:</td>
                        <td>
                            <input type="hidden" ui="type:'TextInput',formname:'sprint_id'" />
                            <input type="hidden" ui="type:'TextInput',formname:'backlog_id'" />
                            <input type="text" size="30" ui="type:'TextInput',formname:'backlog_name',rule:'required'" />
                        </td>
                        <td rowspan="6" style="vertical-align: top; padding-left:20px;">

                        </td>
                    </tr>
                    <tr>
                        <td align="right" valign="top">Sprint:</td>
                        <td>
                            <span style="font-weight123:bold;" ui="type:'Label',formname:'sprint_name'"></span>
                        </td>
                        <td rowspan="6" style="vertical-align: top; padding-left:20px;">

                        </td>
                    </tr>
                    <tr>
                        <td class="inputLabel" style="vertical-align: top;">Description:</td>
                        <td style="vertical-align: top;">
                            <textarea ui="type:'TextInput',formname:'backlog_desc'" cols="40" rows="9"></textarea>
                        </td>
                    </tr>
                    <tr>
                        <td class="inputLabel" style="vertical-align: top;">Index:</td>
                        <td style="vertical-align: top;">
                            <input type="text" size="16" ui="type:'TextInput',formname:'backlog_index'" />
                        </td>
                    </tr>
                    <tr>
                        <td align="right" valign="top"> </td>
                        <td height="40" valign="bottom">
                            <button ui="type:'Button',formname:'submit'">提交</button>
                        </td>
                    </tr>
               </table>


                <!-- target: taskboard_addtask -->


                <div id="addTaskModal">
                    <table id="addTaskTable">
                        <tr>
                            <td align="right" valign="top"> </td>
                            <td align="left" valign="top" colspan="3"><h3>Add Task</h3></td>
                        </tr>
                        <tr>
                            <td align="right" valign="top">Title:</td>
                            <td>
                                <input type="hidden" ui="type:'TextInput',formname:'task_deleted',value:'0'" />
                                <input type="hidden" ui="type:'TextInput',formname:'product_id'" />
                                <input type="hidden" ui="type:'TextInput',formname:'sprint_id'" />
                                <input type="hidden" ui="type:'TextInput',formname:'backlog_id'" />
                                <input type="hidden" ui="type:'TextInput',formname:'task_id'" />
                                <input type="text" ui="type:'TextInput',formname:'task_name',rule:'required'" style="width: 267px;" />
                            </td>
                            <td rowspan="6" style="vertical-align: top; padding-left:20px;">
                                <table cellspacing="0px">
                                    <tr>
                                        <td style="padding-top: 0px;">
                                            <textarea ui="type:'TextInput',formname:'new_comment',isForm:'false'" style="border: 1px solid #A9A9A9; color: #000000; height: 68px; padding: 2px; width: 260px; text-align: left;margin-bottom: 5px;" rows="1" cols="20"></textarea>
                                            <div style="width: 264px; text-align: right;">
                                                <img ui="type:'Button',formname:'btn_addcomment'" src="vm/img/comment-button.gif" title="Post Comment" style="cursor: pointer;" />
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="commentsLabel">Comments:</td>
                                    </tr>
                                    <tr>
                                        <td rowspan="3">
                                            <textarea ui="type:'TextInput',formname:'task_comments'" style="color: black; height: 220px; overflow: scroll; padding-bottom: 2px; padding-top: 2px; vertical-align: top; width: 264px; border: 1px solid #A9A9A9;"></textarea>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                        <tr>
                            <td align="right" valign="top">Backlog:</td>
                            <td>
                                <span style="font-weight123:bold;" ui="type:'Label',formname:'backlog_name'"></span>
                            </td>
                            <td rowspan="6" style="vertical-align: top; padding-left:20px;">

                            </td>
                        </tr>
                        <tr>
                            <td class="inputLabel" style="vertical-align: top;">Description:</td>
                            <td style="vertical-align: top;">
                                <textarea ui="type:'TextInput',formname:'task_desc'" cols="40" rows="9" style="width: 288px;"></textarea>
                            </td>
                        </tr>
                        <tr>
                            <td class="inputLabel">Point Person:</td>
                            <td>
                                <div ui="type:'Dropdown',formname:'task_person',data_value:'uid',data_text:'user_label'" style="width: 288px;"></div>
                            </td>
                        </tr>
                        <tr>
                            <td class="inputLabel">Status:</td>
                            <td>
                                <div ui="type:'Dropdown',formname:'task_status',options:[{value:\'notstarted\',text:'Not Started'},{value:\'impeded\',text:'Impeded'},{value:\'inprogress\',text:'In Progress'},{value:\'done\',text:'Done'}],size:{width:\'150px\'},default_select:true">
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2" style="vertical-align: top">
                                <table>
                                    <tr>
                                        <td class="inputLabel">Team hours remaining:</td>
                                        <td>
                                            <input ui="type:'TextInput',formname:'task_remaining'" size="7" type="text" value="4" />
                                        </td>
                                        <td class="inputLabel" style="padding-left:35px;">Original Estimate:</td>
                                        <td>
                                            <input ui="type:'TextInput',formname:'task_estimate'" size="9" value="4">
                                            </span>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                        <tr style="height: 30px;">
                            <td colspan="2">&nbsp;</td>
                        </tr>
                        <tr>
                            <td align="right" valign="top"> </td>
                            <td height="40" valign="bottom">
                                <button ui="type:'Button',formname:'submit'">提交</button>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <script>
                function initPageAddTask() {
                    // pageHistory
                    var pageHistory;
                    pageHistory = function () {
                        hui.Action.call(this);
                        this.id = 'pageHistory';
                        this.main = 'history';
                    };
                    pageHistory.prototype = {
                        initBehavior: function () {
                            var me = this;
                            me.showTestHistory();
                        },
                        finish: function () {
                            var me = this;
                            showTab('history');
                        },
                        showTestHistory: function () {
                            hui.Mockup.setRule('/ue_api/internal/get_test_history', [
                                null, [{
                                    user: 'a001',
                                    time: '30 m',
                                    score: '35',
                                    date: '2015-01-05 16:40'
                                }, {
                                    user: 'a001',
                                    time: '30 m',
                                    score: '35',
                                    date: '2015-01-05 16:40'
                                }, {
                                    user: 'a001',
                                    time: '30 m',
                                    score: '35',
                                    date: '2015-01-05 16:40'
                                }, {
                                    user: 'a001',
                                    time: '30 m',
                                    score: '35',
                                    date: '2015-01-05 16:40'
                                }, {
                                    user: 'a001',
                                    time: '30 m',
                                    score: '35',
                                    date: '2015-01-05 16:40'
                                }, {
                                    user: 'a001',
                                    time: '30 m',
                                    score: '35',
                                    date: '2015-01-05 16:40'
                                }]
                            ]);
                            Requester.get('/ue_api/internal/get_test_history?rand=' + Math.random(), {
                                onsuccess: function (result) {
                                    if (result && !result[0] && result[1]) {
                                        var tpl = [
                                            '<li class="item_row">',
                                            '    <span class="t_user">#{user}</span>',
                                            '    <span class="t_time">#{time}</span>',
                                            '    <span class="t_score">#{score}</span>',
                                            '    <span class="t_date">#{date}</span>',
                                            '</li>'
                                        ].join('');

                                        var list = result[1];
                                        var html = '';
                                        for (var i = 0, len = list.length; i < len; i++) {
                                            html += hui.util.format(tpl, list[i]);
                                        }
                                        hui.g('history_list').innerHTML = html;
                                    }
                                }
                            });
                        },

                    };

                    hui.inherits(pageHistory, hui.Action);
                    hui.Router.setRule('/history', 'pageHistory');
                    hui.window.pageHistory = pageHistory;
                }
            </script>
            <div class="page_body" id="industry" style="background-color: white;display: none;">
                <!-- target: taskboard_impediment -->
                <style type="text/css">
                #editImpedimentTable { margin: 5px; }
                #editImpedimentDiv td { padding-bottom: 2px; padding-right: 2px; }
                .inputLabel { width: 100px; text-align: right; font-size: 9pt; color: black; }
                #impediment_Title { width: 250px; }
                input { vertical-align: middle; }
                #impediment_Description { width: 250px; }
                textarea { font-size: 10pt; font-family: Arial, Helvetica, sans-serif; }
                #impediment_Reporter { width: 150px; }
                </style>
                <div id="editImpedimentDiv">
                    <table id="editImpedimentTable">
                        <tr>
                            <td class="inputLabel">Title:</td>
                            <td>
                                <input id="impediment_Title" type="text" />
                            </td>
                        </tr>
                        <tr>
                            <td class="inputLabel" style="vertical-align: top;">Description:</td>
                            <td>
                                <textarea id="impediment_Description" cols="40" rows="6" name="S1"></textarea>
                            </td>
                        </tr>
                        <tr>
                            <td class="inputLabel">Reporter:</td>
                            <td>
                                <select id="impediment_Reporter" name="D1">
                                    <option value="">(unspecified)</option>
                                    <option value="Aaron.lu (aaron.lu)">Aaron.lu (aaron.lu)</option>
                                    <option value="Ada.yang (ada.yang)">Ada.yang (ada.yang)</option>
                                    <option value="Andy.wang (andy.wang)">Andy.wang (andy.wang)</option>
                                    <option value="Blanche.xu (blanche.xu)">Blanche.xu (blanche.xu)
                                    </option>
                                    <option value="Chloe.yang (chloe.yang)">Chloe.yang (chloe.yang)
                                    </option>
                                    <option value="Cindy.liu (cindy.liu)">Cindy.liu (cindy.liu)</option>
                                    <option value="Colin.zhang (colin.zhang)">Colin.zhang (colin.zhang)
                                    </option>
                                    <option value="Daini.xu (daini.xu)">Daini.xu (daini.xu)</option>
                                    <option value="David (david)">David (david)</option>
                                    <option value="Ethan (ethan)">Ethan (ethan)</option>
                                    <option value="Harrison.lin (harrison.lin)">Harrison.lin (harrison.lin)
                                    </option>
                                    <option value="Jason (jason)">Jason (jason)</option>
                                    <option value="Jicheng.li (jicheng.li)">Jicheng.li (jicheng.li)
                                    </option>
                                    <option value="Richard.xu (richard.xu)">Richard.xu (richard.xu)
                                    </option>
                                    <option value="Steven.cheng (steven.cheng)">Steven.cheng (steven.cheng)
                                    </option>
                                    <option value="Tiennan.lin (tiennan.lin)">Tiennan.lin (tiennan.lin)
                                    </option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td class="inputLabel">Resolved:</td>
                            <td>
                                <input id="impediment_Resolved" name="impediment_Resolved" type="checkbox" />
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td style="text-align: right;">
                                <input class="impediment_OK" style="cursor: pointer;" id="impediment_OK" src="vm/img/ok-button-active.gif" title="OK" type="image" />
                                <input class="impediment_Cancel" style="cursor: pointer;" id="impediment_Cancel" src="vm/img/cancel-button-active.gif" title="Cancel" type="image" />
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <script>
                function initPageComment() {
                    // pageIndustry
                    var pageIndustry;
                    pageIndustry = function () {
                        hui.Action.call(this);
                        this.id = 'pageIndustry';
                        this.main = 'industry';
                    };
                    pageIndustry.prototype = {
                        initBehavior: function () {
                            var me = this;
                        },
                        finish: function () {
                            var me = this;
                            showTab('industry');
                        }

                    };

                    hui.inherits(pageIndustry, hui.Action);
                    hui.Router.setRule('/industry', 'pageIndustry');
                    hui.window.pageIndustry = pageIndustry;
                }
            </script>

        </div>
        <div class="page_foot">
            <!--div class="page_container">
                沪ICP备15001838号 上海轩禄商务咨询有限公司 ©2015 版权所有
            </div-->
        </div>
    </div>

    <div id="subject_add" class="subject_test">





    </div>

    <!-- script type="text/javascript" src="http://bpmjs.org/bpm_api/combo??hui_requester@0.0.1,hui_action@0.0.1,hui_panel@0.0.1,hui_table@0.0.1,hui_checkbox@0.0.1,hui_textinput@0.0.1,hui_button@0.0.1,hui_template@0.0.1,hui_checklabel@0.0.1,hui_boxpanel@0.0.1,hui_label@0.0.1,hui_slider@0.0.1,hui_radiobox@0.0.1,hui_dropdown@0.0.1,hui_validator@0.0.1?debug=true"></script -->
    <!-- script type="text/javascript" src="http://bpmjs.org/js/??hui@0.0.1/hui.js,hui_validator@0.0.1/hui_validator.js,hui_util@0.0.1/hui_util.js,hui_dropdown@0.0.1/hui_dropdown.js,hui_control@0.0.1/hui_control.js,hui_radiobox@0.0.1/hui_radiobox.js,hui_checkbox@0.0.1/hui_checkbox.js,hui_slider@0.0.1/hui_slider.js,hui_draggable@0.0.1/hui_draggable.js,hui_label@0.0.1/hui_label.js,hui_boxpanel@0.0.1/hui_boxpanel.js,hui_checklabel@0.0.1/hui_checklabel.js,hui_template@0.0.1/hui_template.js,hui_button@0.0.1/hui_button.js,hui_textinput@0.0.1/hui_textinput.js,hui_table@0.0.1/hui_table.js,hui_panel@0.0.1/hui_panel.js,hui_action@0.0.1/hui_action.js,hui_requester@0.0.1/hui_requester.js?debug=true"></script -->
    <script type="text/javascript" src="src/hui@0.0.1/hui.js"></script>
    <script type="text/javascript" src="src/jquery1.8.3.js"></script>
    <script type="text/javascript" src="src/highcharts.js"></script>   
    <script type="text/javascript" src="src/hui_validator@0.0.1/hui_validator.js"></script>
    <script type="text/javascript" src="src/hui_util@0.0.1/hui_util.js"></script>
    <script type="text/javascript" src="src/hui_dropdown@0.0.1/hui_dropdown.js"></script>
    <script type="text/javascript" src="src/hui_control@0.0.1/hui_control.js"></script>
    <script type="text/javascript" src="src/hui_radiobox@0.0.1/hui_radiobox.js"></script>
    <script type="text/javascript" src="src/hui_checkbox@0.0.1/hui_checkbox.js"></script>
    <script type="text/javascript" src="src/hui_slider@0.0.1/hui_slider.js"></script>
    <script type="text/javascript" src="src/hui_draggable@0.0.1/hui_draggable.js"></script>
    <script type="text/javascript" src="src/hui_label@0.0.1/hui_label.js"></script>
    <script type="text/javascript" src="src/hui_boxpanel@0.0.1/hui_boxpanel.js"></script>
    <script type="text/javascript" src="src/hui_mask@0.0.1/hui_mask.js"></script>
    <script type="text/javascript" src="src/hui_checklabel@0.0.1/hui_checklabel.js"></script>
    <script type="text/javascript" src="src/hui_template@0.0.1/hui_template.js"></script>
    <script type="text/javascript" src="src/hui_button@0.0.1/hui_button.js"></script>
    <script type="text/javascript" src="src/hui_select@0.0.1/hui_select.js"></script>
    <script type="text/javascript" src="src/hui_textinput@0.0.1/hui_textinput.js"></script>
    <script type="text/javascript" src="src/hui_table@0.0.1/hui_table.js"></script>
    <script type="text/javascript" src="src/hui_panel@0.0.1/hui_panel.js"></script>
    <script type="text/javascript" src="src/hui_action@0.0.1/hui_action.js"></script>
    <script type="text/javascript" src="src/hui_requester@0.0.1/hui_requester.js"></script>
    <script type="text/javascript" src="src/hui_taskboard@0.0.1/hui_taskboard.js"></script>
    <script type="text/javascript" src="src/hui_burndown@0.0.1/hui_burndown.js"></script>
    <script type="text/javascript" src="src/hui_memberload@0.0.1/hui_memberload.js"></script>
    <!-- Only for highrchart!!  -->
    <!--script type="text/javascript" src="src/jquery1.9.1.js         "></script>
    <script type="text/javascript" src="src/highcharts.js          "></script>
    <script type="text/javascript" src="src/highcharts-more.js     "></script-->
    <script type="text/javascript" src="src/ext_dragdrop.js          "></script>
    <script type="text/javascript" src="src/ext_chart.js             "></script>
    <script type="text/javascript" src="src/ext_md5.js             "></script>
    <script type="text/javascript" src="src/underscore.js             "></script>

</body>

</html>