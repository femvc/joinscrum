<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Ymatou Scrumwork</title>
    <style type="text/css">
    html {padding: 0px; margin: 0px;}
    body {padding: 0px; margin: 0px; font-family: 'Microsoft YaHei'; }
    img {border: 0px;}
    a {border: 0px; color: green; }
    a:hover {color: #f60;}
    .clearfix {clear: both; font-size: 1px; height: 1px; line-height: 1px; margin-top: -1px; overflow: hidden;}
    .link { border:0px; color: #008000; display: inline; background-color: transparent; font-weight: bold; text-decoration: underline; cursor: pointer; padding: 0px 1px 0px 0px; font-size: 14px; }
    .link:hover { color: #FF6600; }
    .validate-text {color:red;}

    </style>


    <script type="text/javascript">
        'use strict';

        window.onload = function () {
            // Requester.get('/ue_api/internal/account/get_uid?rand=' + Math.random(), {
            //     onsuccess: function (result) {
            //         if (result && !result[0] && result[1]) {
            //             hui.g('uid').innerHTML = String(result[1]);
            //             hui.cc('link').style.display = 'block';
            //         }
            //     }
            // });

            // window.test_id = hui.util.getCookie('test_id');
            hui.context = new hui.BaseModel();
            
            initPageLogin();
            initPageIndex();

            hui.Template.parseTemplate(hui.g('history').innerHTML);

            hui.Action.start();
        };
        function showTab(tab, main) {
            hui.g('login'    ).style.display = 'none';
            hui.g('index'    ).style.display = 'none';
            hui.g('history'  ).style.display = 'none';
            

            main = main || tab;
            hui.g(main).style.display = 'block';
        }

        //-->
    </script>
</head>

<body style="" onload123="initForTest()">
    <!--.page>.page_head>.logo^+.page_banner>h1.test_title{你想知道自己前端技术实力排名吗？}+.test_desc{2014年，北京、上海、广州的互联网公司已超过30,000家，其中前端开发人员已超过100,000人，想知道你自己技术实力的排名吗}+.test_btn{立即测试}^+.page_foot{2014-10-17}-->
    <div class="page" style="width: 927px; margin-left: 20px;">
        <div id="main" style="min-height: 750px;">
            <!-- Login -->
            <div class="page_login" id="login" style="display:none">
                <!-- target: login -->
                <style type="text/css">
                    .page_login  {}
                    .page_login .loginboxtitle { font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; border: 1px solid #c0c0c0; padding-left: 11px; padding-right: 11px;  background: #c0c0c0; font-weight: bold; line-height: 21px; margin-top: 30px; margin-bottom: 0px; }
                    .page_login .loginbox { font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; border: 1px solid #c0c0c0; padding-left: 11px; padding-right: 11px; margin-top: 0px; padding-top: 20px; color: #808080; }
                    .page_login .logintable { margin-top: 20px; }
                    .page_login .center { display: inline; text-align: center; }
                    .page_login .loginprompt { font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; text-align: right; vertical-align: top; color: #252525; border: 1px solid; margin-bottom: 11px; }
                    .page_login .header {  }
                    .page_login .header .headertext {  }
                    .page_login .header a { text-decoration: underline; color: white; }
                </style>
                <div class="header" style="height: 100px;border-bottom: 3px  solid #f50;">
                    <h1 class="header_title" style="float: left;padding:0px;margin:0px;"><img src="vm/img/logo-scrum.png" alt="" /></h1>
                </div>
                <div>
                    <div class="loginboxtitle" style="width:890px;">Web Client Login</div>
                    <div class="loginbox" style="width:890px;">
                        <div>
                            The Ymatou provides a personalized view and limited updating of scrum data such as your task status and remaining hours.
                        </div>
                        <div class="logintable" style="line-height: 30px;">
                            <form method="post" action="/">
                                <!-- 搞笑，FF下table设置align="left" 居然有bug -->
                                <table cellspadding="5">
                                    <tr>
                                        <td valign="top">Username:</td>
                                        <td>
                                            <input type="text" value="" style="width: 120px;" ui="type:'TextInput',formname:'username',rule:'required'">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td valign="top">Password:</td>
                                        <td>
                                            <input type="password" value="aaa" style="width: 120px;" ui="type:'TextInput',formname:'password',rule:'required'">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>&nbsp;</td>
                                        <td>
                                            <button class="button" type="button" ui="type:'Button',formname:'login_submit'">Login</button>
                                        </td>
                                    </tr>
                                </table>
                                <br />
                                <br />
                            </form>
                        </div>
                    </div>
                </div>
                <div style="color: #AAAAAA; margin: 20px 20px 0px; padding-bottom:20px; text-align: center; width: 970px;">Copyright © 2015 Ymatou, Inc. All rights reserved.</div>
            </div>
            <script>
                function initPageLogin() {
                    // pageLogin
                    var pageLogin;
                    pageLogin = function () {
                        hui.Action.call(this);
                        this.id = 'pageLogin';
                        this.main = 'login';

                        this.model = new hui.BaseModel({});
                        this.BACK_LOCATION = '/login';
                    };
                    pageLogin.prototype = {
                        /**
                         * @name 初始化列表行为
                         * @param {Object} controlMap 当前主内容区域绘制的控件集合.
                         */
                        initBehavior: function(controlMap) {
                            var me = this;
                            
                            if (me.querystring['logout']) {
                                Requester.get('/ue_api/internal/user_logout', {
                                    onsuccess: new Function()
                                });
                                
                                hui.context.set('mid', '');
                                hui.context.set('token', '');
                            }
                            
                            var username = me.getByFormname('username');
                            var password = me.getByFormname('password');
                            var login_submit = me.getByFormname('login_submit');

                            if (username.getValue() == '' && hui.getCookie('un')) {
                                 username.setValue(hui.getCookie('un'));
                            }
                            
                            username.onenter = password.onenter = login_submit.onclick = function(){ me.onSubmit();};
                            
                        },
                        /**
                         * @name 初始化列表行为
                         * @param {Object} controlMap 当前主内容区域绘制的控件集合.
                         */
                        onSubmit: function(){
                            if (this.validate()) {
                                var me = this,
                                    username = me.getByFormname('username').getValue(),
                                    password = me.getByFormname('password').getValue();
                                
                                Requester.get('/ue_api/internal/user_login', {
                                    data: { 
                                        username: username,
                                        password: MD5.encode(password)
                                    },  
                                    onsuccess: hui.fn(me.loginCallback, me)
                                });
                            }
                        },
                        loginCallback: function(data){
                            var me = this,
                                result = data ? data[1] : [];
                            if (!data[0] && result.mid) {
                                
                                hui.context.set('mid', result['mid']);
                                hui.context.set('token', result['token']);
                                hui.setCookie('mid', result['mid'], 360 * 24 * 60 * 60 * 1000);
                                hui.setCookie('un', result['username'], 360 * 24 * 60 * 60 * 1000);
                                hui.setCookie('token', result['token']);

                                if (hui.Locator.currentLocation.indexOf('/login') == 0) {
                                    hui.setCookie('taskboard_user', result['mid']);
                                    //  hui.Locator.redirect('/');
                                    window.location.href = '#!/';
                                }
                                else {
                                    // hui.Locator.reload();
                                    window.location.reload();
                                }
                            }
                            else {
                                me.getByFormname('username').showError(data[0].mobile);
                            }
                        },
                        finish: function () {
                            var me = this;
                            showTab('login');
                        }
                    };

                    hui.inherits(pageLogin, hui.Action);
                    hui.Router.setRule('/login', 'pageLogin');
                    hui.window.pageLogin = pageLogin;
                }
            </script>
            <div class="page_body" id="index" style="display: none;">
                <!-- target: taskboard_layout -->
                
                <div class="header" style="height: 100px;border-bottom: 3px  solid #f50;">
                    <h1 class="header_title" style="float: left;padding:0px;margin:0px;"><img src="vm/img/logo-scrum.png" alt="" /></h1>
                    <div class="headertext" style="float: left;margin-top:20px;width: 616px;text-align: right;">
                        Welcome: <span id="welcome_user">andy.wang</span>
                        <span style="padding-left: 20px;">
                            <a href="#!/login~logout=true">Log out</a> |
                            <a href="#">Home</a> |
                            <a href="#!/help" target="_blank">Help</a>
                        </span>
                    </div>
                </div>
                <div class="content">
                    <div id="needsUpdate" style="display: none;">
                        <img src="vm/img/refresh_alert_final.gif" alt="Changes have been made to this page by another User. Click this message to update display." onclick="window.location.reload();//hui.Locator.reload();" />
                    </div>
                    <div class="error" id="noSprints" style="display: none">
                        There are no sprints in the selected product.
                    </div>
                    <div class="error" id="noPbis" style="display: none">
                        There are no backlog items in this sprint.
                    </div>
                    <div class="error" id="noTaskAccess" style="display: none">
                        You don&#39;t have access to view any tasks for this product.
                    </div>

                    <div id="selectors">
                        <table class="selectors" width="100%">
                            <tr>
                                <td colspan="2">
                                    <span>Product:</span>
                                    <button class="link" style="margin-left: 0px;" onclick="hui.Master.get().addProduct()">add</button><i>/</i>
                                    <button class="link" style="margin-left:0px;" onclick="hui.Master.get().editProduct()">edit</button>
                                </td>
                                <td style="vertical-align: bottom;">
                                    
                                </td>
                                <td><label style="float: right;margin-top: 5px;margin-right: 10px;">Highlight Tasks</label> </td>
                            </tr>
                            <tr>
                                <td width="170">
                                    <div ui="type:'Dropdown',formname:'product_list',data_value:'product_id',data_text:'product_name',default_select:true" style="width:150px;"></div>
                                </td>
                                <td width="100">
                                    Sprint: <button class="link" style="" onclick="hui.Master.get().addSprint()">add </button>
                                </td>
                                <td>
                                    <input id="include_burndown" name="include_burndown" type="checkbox" onclick="hui.setCookie('include_burndown', String(this.checked));hui.Master.get().switchProduct()" />
                                    <label for="include_deleted">Burndown chart</label>
                                    <input id="include_done" name="include_done" type="checkbox" onclick="hui.setCookie('include_done', String(this.checked));hui.Master.get().switchProduct()" />
                                    <label for="include_done">Done sprint</label>
                                    <input id="include_deleted" name="include_deleted" type="checkbox" onclick="hui.setCookie('include_deleted', String(this.checked));hui.Master.get().switchProduct()" />
                                    <label for="include_deleted">Deleted task</label>
                                    
                                </td>
                                <td>
                                    <div ui="type:'Dropdown',formname:'member_list',data_value:'uid',data_text:'user_label'" style="width:230px; float: right;">
                                        <!--option value="Aaron.lu (aaron.lu)">Aaron.lu (aaron.lu)</option-->
                                    </div>
                                    
                                </td>
                            </tr>
                        </table>
                    </div>

                    <style>
                    .sectionHeader_n {
                        padding: 0px;
                        margin: 0px;
                        height: 28px;
                        color: white;
                        background: url('vm/img/taskboard-header-slice.gif') repeat-x 0 0;
                        font-size: 14px;
                        border-radius: 5px;
                        padding-top: 3px;
                        padding-left: 10px;
                        margin-top: 16px;
                    }
                    .taskboard-title {padding: 10px 1px 8px;}
                    .taskboard-title b {  border-left: 4px solid #f50;padding-left: 5px;}
                    </style>
                    <div class="" style="width123:927px;">
                        <h3 class="sectionHeader_n">Taskboard: All Tasks</h3>
                        <div id="taskboard" ui="type:'Panel',formname:'taskboard'"></div>
                        <h3 class="sectionHeader_n" style="margin-bottom: 25px;">Team Member Load</h3>
                        <div id="memberload" ui="type:'Panel',formname:'memberload'" style="min-height: 410px;"></div>
                    </div>


                    <div class="error" id="noBurndown" style="display: none">
                        You either do not have permission to view tasks or there are no sprints for this product.
                    </div>

                </div>
                <br /><br />
                <hr style="  border: 1px solid #eee;" />
                <div style="color: #AAAAAA; margin: 20px 20px 0px; padding-bottom:20px; text-align: center; width: 970px;">Copyright &copy; 2015 Ymatou, Inc. All rights reserved.</div>
            </div>
            <script>
                function initPageIndex() {
                    // pageTaskboard
                    var pageTaskboard;
                    pageTaskboard = function () {
                        hui.Action.call(this);
                        /**
                         * @name Action索引ID
                         * @comment 主要用于控件中通过onclick="hui.Control.getById('listTable','login');
                         */
                        this.id = 'taskboard';
                        // this.view = 'taskboard_layout';
                        this.BACK_LOCATION = '/login';
                        this.main = 'index';
                    };
                    pageTaskboard.prototype = {
                        initModel: function(callback){
                            var me = this;
                            //me.getSprintData(callback);

                            callback&&callback();
                        },
                        getSprintData: function (callback) {
                            var me = this;
                            Requester.get('/ue_api/internal/user_list', {
                                onsuccess: function (data) {
                                    me.model.set('user_list'   , _.sortBy(data[1].items, '_id').reverse());
                                    me.getSprintDataCallback(callback);
                                }
                            });
                            Requester.get('/ue_api/internal/product_list', {
                                onsuccess: function (data) {
                                    me.model.set('product_list'   , _.sortBy(data[1].items, 'product_index').reverse());
                                    me.getSprintDataCallback(callback);
                                }
                            });
                            
                        },
                        getSprintDataCallback: function (callback) {
                            var me = this;
                            if (me.model.get('user_list') && me.model.get('product_list')) {
                                callback&&callback();
                                //this.getTaskData(callback)
                            }
                        },
                        initBehavior: function(controlMap) {
                            var me = this;
                            
                            // hui.Master.get().controlMap.vModal2.show();
                            // me.controlMap.submit.onclick = hui.fn(me.onSubmit, me);
                              

                        },
                        finish: function () {
                            var me = this;
                            showTab('index');

                            if (hui.getCookie('include_deleted') === 'true') {
                                hui.g('include_deleted').checked = 'checked';
                            }
                            if (hui.getCookie('include_done') === 'true') {
                                hui.g('include_done').checked = 'checked';
                            }
                            if (hui.getCookie('include_burndown') === 'true') {
                                hui.g('include_burndown').checked = 'checked';
                            }
                            
                            me.getSprintData(function(){
                                var productList = hui.Control.getByFormname('product_list');
                                productList.setOptions(me.model.get('product_list'));
                                productList.setValue(hui.getCookie('taskboard_product'));
                                productList.onchange = hui.fn(me.switchProduct, me);
                                
                                var userList    = hui.Control.getByFormname('member_list' );
                                userList.onassignvalue = userList.onchange    = hui.fn(me.switchUser, me);  
                                
                                me.switchProduct();

                                var user = me.getUserItem(hui.getCookie('mid'));
                                hui.g('welcome_user').innerHTML = user.realname;
                                
                            });
                            //me.switchProduct();
                            
                            hui.setCookie('task_lastmodify', ''); 
                            me.checkTaskModify();
                        },
                        switchUser: function () {
                            var me = this;
                            me.highlightTask();
                        },
                        switchProduct: function(){
                            var me = this;
                            var product_id = hui.Control.getByFormname('product_list').getValue();
                            hui.setCookie('taskboard_product', product_id);

                            var userList   = hui.Control.getByFormname('member_list' );
                            userList.setOptions(me.getMemberList());
                            userList.setValue(hui.getCookie('taskboard_user'));

                            me.model.remove('sprint_list');
                            me.model.remove('backlog_list');
                            me.model.remove('task_list');
                            me.model.remove('taskindex_list');

                            var include_done = hui.g('include_done').checked ? '&include_done=yes' : '';
                            Requester.get('/ue_api/internal/sprint_list?product_id=' + product_id + include_done, {
                                onsuccess: function (data) {
                                    me.model.set('sprint_list'   , _.sortBy(data[1].items, 'sprint_index'));
                                    me.switchProductCallback();
                                }
                            });
                            Requester.get('/ue_api/internal/backlog_list?product_id='+product_id, {
                                onsuccess: function (data) {
                                    me.model.set('backlog_list'   , _.sortBy(data[1].items, 'backlog_index'));
                                    me.switchProductCallback();
                                }
                            });
                            var include_deleted = hui.getCookie('include_deleted') === 'true' ? '' : '&task_deleted=0';
                            Requester.get('/ue_api/internal/task_list?product_id='+ product_id + include_deleted, {
                                onsuccess: function (data) {
                                    //me.model.set('task_list'   , _.sortBy(data[1].items, 'task_index').reverse());
                                    me.model.set('task_list'   , data[1].items);
                                    me.switchProductCallback();
                                }
                            });
                            
                            Requester.get('/ue_api/internal/taskindex_list?product_id=' + product_id, {
                                onsuccess: function (data) {
                                    //me.model.set('task_list'   , _.sortBy(data[1].items, 'task_index').reverse());
                                    me.model.set('taskindex_list'   , data[1].items);
                                    me.switchProductCallback();
                                }
                            });
                            
                        },
                        switchProductCallback: function (sprint_id) {
                            var me = this,
                                task_list;
                            if (me.model.get('sprint_list') && me.model.get('backlog_list') && me.model.get('task_list') && me.model.get('taskindex_list')) { //

                                hui.Control.getByFormname('taskboard').disposeChild();

                                var product_id = hui.Control.getByFormname('product_list').getValue();
                                var sprint_list = _.filter(me.model.get('sprint_list'), function(item){
                                        return item.product_id == product_id
                                    });
                                sprint_list = _.sortBy(sprint_list, 'sprint_index');
                                for (var i=0,len=sprint_list.length; i<len; i++) {
                                    var taskboard = hui.Control.create('Taskboard', {
                                            formname:'taskboard' + sprint_list[i].sprint_id, 
                                            sprint_id: sprint_list[i].sprint_id, 
                                            sprint_data: sprint_list[i],
                                            parentElement: document.getElementById('taskboard')
                                        });
                                    
                                    taskboard.taskList = me.sortTask(sprint_list[i].sprint_id); 
                                    me.repaintTaskboard(taskboard);
                                    // me.repaintBurden(sprint_list[i].sprint_id);
                                    if (hui.getCookie('include_burndown') === 'true') {
                                        var burndown = hui.Control.create('Burndown', {
                                            formname:'burndown', 
                                            parentElement: document.getElementById('taskboard'),
                                            sprint_id: sprint_list[i].sprint_id,
                                            product_id: product_id
                                        });
                                    }
                                }

                                me.repaintMemberloadCallback();

                            }
                        },
                        sortTask: function (sprint_id) {
                            var me = this,
                                task_list = _.filter(me.model.get('task_list'), function(a){ return a.sprint_id == sprint_id; }),
                                taskindex_list = _.filter(me.model.get('taskindex_list'), function(a){ return a.sprint_id == sprint_id; }),
                                taskList = {},
                                item,
                                index = 1;
                            
                            for (var i=0,len=taskindex_list.length; i<len; i++) {
                                item = taskindex_list[i].taskindex;
                                for (var j=0,len2=item.length; j<len2; j++) {
                                    if (!taskList[item[j]]) {
                                        taskList[item[j]] = index++;
                                    }
                                }
                            }
                            for (var i=0,len=task_list.length; i<len; i++) {
                                task_list[i].task_index = taskList[task_list[i].task_id];
                            }
                            
                            return _.sortBy(task_list, 'task_index');
                        },
                        getUserList: function () {
                            var me = this,
                                list = me.model.get('user_list');
                            for (var i=0,len=list.length; i<len; i++) {
                                list[i].user_label = (list[i].realname !== undefined ? list[i].realname : list[i].username) + ' (' + list[i].username + ')';
                            }
                            return _.sortBy(list, 'realname');        
                        },
                        getMemberList: function () {
                            var me = this;
                            var result = [];
                            var list = me.model.get('user_list');
                            var product_id = hui.Control.getByFormname('product_list').getValue();
                            var product_member = ','+me.getProductItem(product_id).product_member.join(',')+',';
                            for (var i=0,len=list.length; i<len; i++) {
                                if (~product_member.indexOf(list[i].uid) || list[i].username === 'unspecified') {
                                    list[i].user_label = (list[i].realname !== undefined ? list[i].realname : list[i].username) + ' (' + list[i].username + ')';
                                    result.push(list[i]);
                                }
                            }
                            return _.sortBy(result, 'realname');        
                        },
                        getUserItem: function (id) {
                            var me = this,
                                list = me.model.get('user_list'),
                                item = null;
                            id = id === '' ? 'unspecified' : id;
                            
                            for (var i=0,len=list.length; i<len; i++) {
                                if (list[i].uid == id) {
                                    item = list[i];
                                    break;
                                }
                            }
                            return item;        
                        },
                        getDataItem: function (n, id) {
                            var me = this,
                                list = me.model.get(n + '_list'),
                                item = null;
                            for (var i=0,len=list.length; i<len; i++) {
                                if (list[i][n + '_id'] === id) {
                                    item = list[i];
                                    break;
                                }
                            }
                            return item;        
                        },
                        getProductItem: function (id) {
                            return this.getDataItem('product', id);        
                        },
                        getSprintItem: function (id) {
                            return this.getDataItem('sprint', id);      
                        },
                        getBacklogItem: function (id) {
                            return this.getDataItem('backlog', id);    
                        },
                        getTaskItem: function (id) {
                            return this.getDataItem('task', id); 
                        },
                        /**
                         * @name 新增backlog
                         * @public
                         */
                        addBacklog: function (sprint_id) {
                            this.editBacklog(sprint_id);
                        },
                        /**
                         * @name 修改backlog
                         * @public
                         * @param {string} [backlog_id] 
                         */
                        editBacklog: function (sprint_id, backlog_id) {
                            var me = this,
                                nc = hui.Control.getById('editBacklog', me),
                                backlogValue,
                                backlogItem;
                            
                            // 确定backlogItem的值
                            backlogValue = {sprint_id: sprint_id};
                            if (backlog_id) {
                                backlogItem = me.getBacklogItem(backlog_id);
                                if (backlogItem) {
                                    backlogValue.backlog_id     = backlogItem.backlog_id;
                                    backlogValue.backlog_name   = backlogItem.backlog_name;   
                                    backlogValue.backlog_desc   = backlogItem.backlog_desc;
                                    backlogValue.backlog_index  = backlogItem.backlog_index;  
                                    backlogValue.sprint_id      = backlogItem.sprint_id;      
                                }
                            }
                            backlogValue.sprint_name = me.getSprintItem(backlogValue.sprint_id).sprint_name;
                            // 弹出对话框
                            if (nc) {
                                nc.dispose();
                            }
                            nc = hui.Control.create('Boxpanel', {
                                id: 'editBacklog', 
                                title: backlog_id ? ' Edit Backlog' : ' Add Backlog', 
                                contentView: 'taskboard_addbacklog', 
                                size: { width:'500px', height: '400px', bottom: '8%'}
                            });
                            me.appendControl(nc);
                            if (backlog_id) {
                                var dialog_title = hui.cc('dialog_title', nc.getMain());
                                dialog_title.innerHTML = dialog_title.innerHTML.replace('Add', 'Edit');
                            }

                            // 绑定事件
                            nc.getByFormname('submit').onclick = new Function('hui.Master.get().saveBacklog(\''+backlogValue.sprint_id+'\', \''+backlog_id+'\')');
                            
                            nc.setValueByTree(backlogValue);
                            nc.show();
                        },
                        saveBacklog: function (sprint_id, backlog_id) {
                            var me = this;
                            var nc = hui.Control.getById('editBacklog', me),
                                taskboard = hui.Control.getByFormname('taskboard'+sprint_id);
                            
                            if (nc && nc.validate()) {
                                var backlogValue = nc.getParamMap();
                                backlogValue.product_id = me.getSprintItem(sprint_id).product_id;
                                
                                Requester.get('/ue_api/internal/backlog_save', {
                                    data: backlogValue,
                                    onsuccess: hui.fn(me.saveBacklogCallback, me)
                                });
                            }
                        },
                        saveBacklogCallback: function (data) {
                            var me = this;
                            if (!data[0] && data[1]) {
                                // 销毁对话框
                                hui.Control.getById('editBacklog', me).dispose();
                                
                                // me.switchSprint(); 
                                window.location.reload();
                            }
                        },
                        repaintTaskboard: function (taskboard) {
                            var me = this;
                            //var taskboard = hui.Control.getByFormname('taskboard');
                            taskboard.removeBacklogRow('all');
                            
                            taskboard.product_key = me.getProductItem(hui.Control.getByFormname('product_list').getValue()).product_key;
                            taskboard.backlogList = _.filter(me.model.get('backlog_list'), function(a){
                                return a.sprint_id == taskboard.sprint_id});
                            
                            taskboard.setBacklogList();
                            taskboard.setTaskList();

                            me.highlightTask();                            
                            
                        },
                        
                        /**
                         * @name 操作task
                         * @public
                         */
                        takeTask: function (task_id) {
                            var me = this,
                                uid = hui.Control.getByFormname('member_list').getValue(),
                                taskItem = me.getTaskItem(task_id);
                            taskItem.task_person    = uid;
                            taskItem.task_deleted   = '0';
                            
                            me.saveTask(taskItem);
                        },
                        moveTask: function (task) {
                            var me = this,
                                task_id = task.elem.id.split('_')[1],
                                str = task.elem.parentNode.id.split('_'),
                                taskItem = me.getTaskItem(task_id);
                            taskItem.task_status    = str[0];
                            taskItem.backlog_id     = str[1];
                            taskItem.task_remaining = taskItem.task_status == 'done' ? 0 : taskItem.task_remaining;
                            taskItem.task_deleted   = '0';
                            
                            me.saveTask(taskItem);
                        },
                        deleteTask: function (task_id) {
                            var me = this,
                                taskItem = me.getTaskItem(task_id);
                            taskItem.task_deleted   = 'deleted';
                            
                            me.saveTask(taskItem);
                        },
                        /**
                         * @name 新增task
                         * @public
                         */
                        addTask: function(backlog_id) {
                            var me = this,
                                users = me.model.get('user_list'),
                                taskItem = {
                                    task_name: ''
                                };
                            var sprint_id = _.find(me.model.get('backlog_list'), function(a){return a.backlog_id == backlog_id}).sprint_id;
                            taskItem.sprint_id  = sprint_id;
                            taskItem.backlog_id = backlog_id;
                            taskItem.task_start = hui.util.formatDate(new Date(), 'yyyy/MM/dd'); 
                            //alert(objId);
                            me.editTask(sprint_id, taskItem);
                        },
                        /**
                         * @name 修改task
                         * @public
                         * @param {string} [task_id] 
                         */
                        editTask: function (sprint_id, taskItem) {
                            var me = this;
                            
                            taskItem = !taskItem.sprint_id ? me.getTaskItem(taskItem) : taskItem;
                            
                            var nc = hui.Control.getById('editTask', me);
                            if (nc) {
                                nc.dispose();
                            }
                            
                            // 弹出对话框
                            nc = hui.Control.create('Boxpanel', {
                                id: 'editTask', 
                                title: '',  
                                contentView: 'taskboard_addtask', 
                                size: { width:'650px', height: '500px', bottom: '8%'}
                            });
                            me.appendControl(nc);
                            if (taskItem.task_name) {
                                var dialog_title = hui.cc('dialog_title', nc.getMain());
                                dialog_title.innerHTML = dialog_title.innerHTML.replace('Add', 'Edit');
                            }

                            // 绑定事件
                            nc.getByFormname('submit').onclick = new Function('hui.Master.get().saveTask()');
                            
                            // nc.setTitle(taskItem.task_name ? ' Edit Task - ' + taskItem.task_name + '' : 
                            //             ' Add Task to - ' + me.getBacklogItem(taskItem.backlog_id).backlog_name + '');
                            // 必须先初始化options，否则task_person无法setValue!!
                            nc.getByFormname('task_person').setOptions(me.getMemberList());
                            nc.getByFormname('task_person').setValue(hui.getCookie('taskboard_user'));
                            // 默认解除deleted状态
                            taskItem.task_deleted = '0';
                            taskItem.backlog_name = me.getBacklogItem(taskItem.backlog_id).backlog_name;
                            
                            nc.setValueByTree(taskItem);
                            nc.show();
                            
                        },
                        saveTask: function (taskValue) {
                            var me = this;
                            
                            if (!taskValue) {
                                var nc = hui.Control.getById('editTask', me);
                                taskValue =  nc && nc.validate() ? nc.getParamMap() : null;
                            }
                            
                            if (taskValue) {
                                // taskValue.backlog_id = Number(taskValue.backlog_id);
                                
                                if (!hui.util.isEqual(taskValue, me.getTaskItem(taskValue.task_id))) {
                                    // 自己修改的，无需显示刷新提示
                                    hui.setCookie('task_lastmodify', '');
                                    taskValue.product_id = me.getSprintItem(taskValue.sprint_id).product_id;
                                    
                                    Requester.get('/ue_api/internal/task_save', {
                                        data: taskValue,
                                        onsuccess: hui.fn(me.saveTaskCallback, me)
                                    });
                                }
                                // 保存任务上下次序
                                if (taskValue.task_id) {
                                    me.saveTaskIndex(taskValue);
                                }
                            }
                        },
                        saveTaskCallback: function (data) {
                            var me = this;
                            if (!data[0] && data[1]) {
                                var taskboard = hui.Control.getByFormname('taskboard'+data[1].sprint_id),
                                    list = me.model.get('task_list'),
                                    isAdd = true,
                                    taskValue = data[1];
                                // 注：更新task_list
                                for (var i=0,len=list.length; i<len; i++) {
                                    if (list[i].task_id === taskValue.task_id) {
                                        list[i] = taskValue;
                                        isAdd = false; 
                                        list[i].task_deleted === 'deleted' && list.splice(i, 1);
                                        break;
                                    }
                                }
                                isAdd && list.push(taskValue);
                                
                                //me.model.set('task_list'   , _.sortBy(list, 'task_index'));
                                me.model.set('task_list'   , list);
                                
                                // 添加到任务板上
                                if (String(taskValue.task_deleted) === 'deleted') {
                                    taskboard.deleteTask(taskValue);
                                }
                                else if (hui.g('task_'+taskValue.task_id)) {
                                    taskboard.updateTask(taskValue);
                                    hui.removeClass(hui.g('task_'+taskValue.task_id), 'deleted');
                                }
                                else {
                                    taskboard.addTaskRow(taskValue);
                                }
                                
                                // 销毁对话框
                                var editTask = hui.Control.getById('editTask', me);
                                editTask&&editTask.dispose();
                                hui.Mask.hide();
                                
                                // 高亮任务
                                me.highlightTask();
                                
                                // 新增任务需保存上下次序
                                isAdd && me.saveTaskIndex(taskValue);

                                // 任务负载情况
                                // me.switchProduct();
                                me.repaintMemberloadCallback();
                            }
                        },
                        saveTaskIndex: function (taskValue) {
                            var me = this,
                                task_id = taskValue.task_id,
                                backlogItem = hui.g('task_' + task_id).parentNode,
                                str = backlogItem.id.split('_'),
                                task_status = str[0],
                                backlog_id = str[1],
                                list = backlogItem.childNodes,
                                taskindex = [];
                            for (var i=0,len=list.length; i<len; i++) {
                                if (list[i] && list[i].className && (' ' + list[i].className + ' ').indexOf(' task ') != -1) {
                                    taskindex.push(list[i].id.split('_')[1]);
                                }
                            }
                            
                            Requester.get('/ue_api/internal/taskindex_save', {
                                data: { 
                                    backlog_id: backlog_id,
                                    task_status: task_status,
                                    sprint_id: me.getBacklogItem(backlog_id).sprint_id,
                                    product_id: me.getSprintItem(me.getBacklogItem(backlog_id).sprint_id).product_id,
                                    taskindex: JSON.stringify(taskindex)
                                },  
                                onsuccess: new Function()
                            });

                        },
                        highlightTask: function () {
                            var me = this,
                                uid = hui.Control.getByFormname('member_list').getValue(),
                                list = hui.c('task'),
                                task_person;
                            for (var i=0,len=list.length; i<len; i++) {
                                task_person = hui.c('pointperson', list[i])[0];
                                if (task_person && task_person.getAttribute('task_person') == uid) {
                                    hui.addClass(list[i], 'taskofuser0');
                                }
                                else {
                                    hui.removeClass(list[i], 'taskofuser0');
                                }
                            }
                            
                            uid && hui.setCookie('taskboard_user', uid);
                            
                        },
                        checkTaskModify: function () {
                            var me = this;
                            return;
                            Requester.get('/ue_api/internal/task_lastmodify?rand=' + Math.random(), {
                                onsuccess: hui.fn(me.checkTaskModifyCallback, me)
                            });
                        },
                        checkTaskModifyCallback: function (data) {
                            var me = this,
                                task_lastmodify = String(hui.getCookie('task_lastmodify')),
                                last_log = data[1][0] ? data[1][0] : {_id: '0'};
                            
                            if (task_lastmodify && task_lastmodify !== String(last_log._id)) {
                                hui.g('needsUpdate').style.display = 'block';
                            }
                            else {            
                                hui.setCookie('task_lastmodify', last_log._id);
                                
                                me.checkTaskModifyTimer = window.setTimeout(function(){me.checkTaskModify();}, 30000);
                            }
                            
                        },
                        /**
                         * @name 修改Product
                         * @public
                         * @param {string} [product_id] 
                         */
                        addProduct: function () {
                            this.editProduct('new');
                        },
                        editProduct: function (isNew) {
                            var me = this,
                                nc = hui.Control.getById('editProduct', me),
                                product_id = hui.Control.getByFormname('product_list').getValue(),
                                productValue,
                                productItem;
                            
                            // 确定productItem的值
                            productValue = {};
                            if (isNew != 'new') {
                                productItem = me.getProductItem(product_id);
                                if (productItem) {
                                    productValue.product_id       = productItem.product_id;
                                    productValue.product_name     = productItem.product_name;   
                                    productValue.product_key      = productItem.product_key;    
                                    productValue.product_index    = productItem.product_index;  
                                    productValue.product_observer = productItem.product_observer;      
                                    productValue.product_member   = productItem.product_member;  
                                }
                            }
                            // 弹出对话框
                            if (nc) {
                                nc.dispose();
                            }
                            var memberlist = '';
                            var userlist = me.model.get('user_list');
                            for (var i=0,len=userlist.length; i<len; i++) {
                                memberlist += !userlist[i].realname && userlist[i].username === 'unspecified' ? '' : '<label ui="type:\'Checkbox\',formname:\'product_member\',value:\''+userlist[i].uid+'\',checked:\'\'">'+userlist[i].realname+'</label>'
                            }
                            var observerlist = '';
                            var userlist = me.model.get('user_list');
                            for (var i=0,len=userlist.length; i<len; i++) {
                                observerlist += !userlist[i].realname && userlist[i].username === 'unspecified' ? '' : '<label ui="type:\'Checkbox\',formname:\'product_observer\',value:\''+userlist[i].uid+'\',checked:\'\'">'+userlist[i].realname+'</label>'
                            }
                            nc = hui.Control.create('Boxpanel', {
                                id: 'editProduct', 
                                title: product_id ? ' Edit Product' : ' Add Product', 
                                contentView: 'taskboard_addproduct', 
                                model: {
                                    memberlist: memberlist,
                                    observerlist: observerlist
                                },
                                size: { width:'500px', height: '530px', bottom: '8%'}
                            });
                            this.appendControl(nc);
                            if (productValue.product_name) {
                                var dialog_title = hui.cc('dialog_title', nc.getMain());
                                dialog_title.innerHTML = dialog_title.innerHTML.replace('Add', 'Edit');
                            }
                            // 绑定事件
                            nc.getByFormname('submit').onclick = new Function('hui.Master.get().saveProduct()');
                            
                            nc.setValueByTree(productValue);
                            nc.show();
                        },
                        saveProduct: function () {
                            var me = this;
                            var nc = hui.Control.getById('editProduct', me);
                            
                            if (nc && nc.validate()) {
                                var productValue = nc.getParamMap();
                                
                                Requester.get('/ue_api/internal/product_save', {
                                    data: productValue,
                                    onsuccess: hui.fn(me.saveProductCallback, me)
                                });
                            }
                        },
                        saveProductCallback: function (data) {
                            var me = this;
                            if (!data[0] && data[1]) {
                                // 销毁对话框
                                hui.Control.getById('editProduct', me).dispose();
                                
                                // hui.setCookie('taskboard_product', data[1][0].product_id);
                                // hui.Locator.reload();
                                window.location.reload();
                            }
                        },
                        /**
                         * @name 修改Sprint
                         * @public
                         * @param {string} [sprint_id] 
                         */
                        addSprint: function () {
                            this.editSprint('', 'new');
                        },
                        editSprint: function (sprint_id, isNew) {
                            var me = this,
                                nc = hui.Control.getById('editSprint', me),
                                product_id = hui.Control.getByFormname('product_list').getValue(),
                                sprintValue,
                                sprintItem;
                            
                            // 确定sprintItem的值
                            sprintValue = {product_id: product_id};
                            if (isNew != 'new') {
                                sprintItem = me.getSprintItem(sprint_id);
                                if (sprintItem) {
                                    sprintValue.sprint_id     = sprintItem.sprint_id;
                                    sprintValue.sprint_name   = sprintItem.sprint_name;   
                                    sprintValue.sprint_desc   = sprintItem.sprint_desc;  
                                    sprintValue.sprint_index  = sprintItem.sprint_index; 
                                    sprintValue.product_id    = sprintItem.product_id;  
                                    sprintValue.sprint_start  = sprintItem.sprint_start;
                                    sprintValue.sprint_finish = sprintItem.sprint_finish;
                                    sprintValue.sprint_done   = sprintItem.sprint_done;
                                }
                            }
                            else {
                                sprintValue.sprint_start  = hui.util.formatDate(new Date(), 'yyyy-MM-dd');  
                                sprintValue.sprint_finish = hui.util.formatDate(hui.util.parseDate(new Date().getTime() + 12*24*60*60*1000), 'yyyy-MM-dd');    
                            }
                            // 弹出对话框
                            if (nc) {
                                nc.dispose();
                            }
                            nc = hui.Control.create('Boxpanel', {
                                id: 'editSprint', 
                                title: sprint_id ? ' Edit Sprint' : ' Add Sprint', 
                                contentView: 'taskboard_addsprint', 
                                size: { width:'500px', height: '400px', bottom: '8%'}
                            });
                            this.appendControl(nc);
                            if (sprint_id) {
                                var dialog_title = hui.cc('dialog_title', nc.getMain());
                                dialog_title.innerHTML = dialog_title.innerHTML.replace('Add', 'Edit');
                            }
                            // 绑定事件
                            nc.getByFormname('submit').onclick = new Function('hui.Master.get().saveSprint()');
                            
                            nc.setValueByTree(sprintValue);
                            nc.show();
                        },
                        saveSprint: function () {
                            var me = this;
                            var nc = hui.Control.getById('editSprint', me);
                            
                            if (nc && nc.validate()) {
                                var sprintValue = nc.getParamMap();
                                
                                Requester.get('/ue_api/internal/sprint_save', {
                                    data: sprintValue,
                                    onsuccess: hui.fn(me.saveSprintCallback, me)
                                });
                            }
                        },
                        saveSprintCallback: function (data) {
                            var me = this;
                            if (!data[0] && data[1]) {
                                // 销毁对话框
                                hui.Control.getById('editSprint', me).dispose();
                                
                                // hui.setCookie('selected_sprint', data[1][0].sprint_id);
                                // hui.Locator.reload();
                                window.location.reload();
                            }
                        },
                        repaintMemberload: function () {
                            var me = this;
                        },
                        repaintMemberloadCallback: function () {
                            var me = this;
                            
                            hui.Control.getByFormname('memberload').disposeChild();
                            
                            var taskList = me.model.get('task_list');
                            var datasource = {}; //{'sprint01': {'user01': 20, 'user02': 30},'sprint02': {'user01': 10, 'user02': 10}};
                            var member = [];
                            for (var i=0,len=taskList.length; i<len; i++) {
                                var item = taskList[i];
                                datasource[item.sprint_id] = datasource[item.sprint_id] || {};
                                datasource[item.sprint_id][item.task_person] = datasource[item.sprint_id][item.task_person] || 0;
                                datasource[item.sprint_id][item.task_person] += isNaN(Number(item.task_remaining)) ? 0 : Number(item.task_remaining);
                                member.push(item.task_person);
                            }
                            member = _.uniq(member).sort().reverse();

                            var hours = [];
                            // [{
                            //     name: 'wechat',
                            //     data: [5, 3, 4, 7, 2, 2, 3, 4, 7, 2, 2, 3, 4, 7, 2, 2, 3, 4, 7, 2, 2]
                            // }, {
                            //     name: 'search',
                            //     data: [2, 2, 3, 2, 1]
                            // }]  
                            var colors = ['#FF9900','#99CC00','#CC9900','#99CC00','#0099CC','#00CC99','#CC5599','#FE8463','#9BCA63','#FAD860','#F3A43B','#60C0DD','#D7504B','#C6E579','#F4E001','#F0805A','#26C0C0'];
                            var barcolor;
                            var lefthours;
                            for (var i in datasource) {
                                barcolor = colors.shift();
                                colors.push(barcolor);
                                lefthours = {
                                    name: me.getSprintItem(i).sprint_name, 
                                    data: [], color: barcolor
                                }; 
                                for (var j=0,len2=member.length; j<len2; j++) {
                                    lefthours.data.push(datasource[i][member[j]] || 0);
                                }
                                hours.push(lefthours);
                            }
                            var username = [];
                            var user;
                            for (var j=0,len2=member.length; j<len2; j++) {
                                user = me.getUserItem(member[j]) || {};
                                username.push(user.realname + '(' + user.username + ')');
                            }

                            var memberload = hui.Control.create('Memberload', {
                                    formname:'memberload', 
                                    parentElement: document.getElementById('memberload'),
                                    member: username,
                                    hours: hours
                                });
                        }
                    };

                    hui.inherits(pageTaskboard, hui.Action);
                    hui.Router.setRule('/', 'pageTaskboard');
                    hui.window.pageTaskboard = pageTaskboard;

                    hui.Locator.addFilter('/', function(next, finish){
                        if (!hui.getCookie('mid')) {
                            // window.location.href = '#!/login';
                            hui.Locator.redirect('#!/login');
                        }
                        else {
                            Requester.get('/ue_api/internal/user_loginstatus', {
                                onsuccess: function(data){
                                    if (data && data[1] && data[1] === 'ok') {
                                        next();
                                    }
                                    else {
                                         hui.Locator.redirect('#!/login');
                                    }
                                }
                            });
                        }
                        
                    })
                }
            </script>
            <div class="page_body" id="history" style="background-color: white;display: none;">
                <!-- target: taskboard_addsprint -->
                <table>
                    <tr>
                        <td align="right" valign="top"> </td>
                        <td align="left" valign="top" colspan="3"><h3 class="dialog_title">Add Sprint</h3></td>
                    </tr>
                    <tr>
                        <td align="right" valign="top" width="115">Sprint Name:</td>
                        <td>
                            <input type="hidden" ui="type:'TextInput',formname:'product_id'" />
                            <input type="hidden" ui="type:'TextInput',formname:'sprint_id'" />
                            <input type="text" size="30" ui="type:'TextInput',formname:'sprint_name',rule:'required'" />
                        </td>
                    </tr>
                    <tr>
                        <td align="right" class="inputLabel" style="vertical-align: top;">Description:</td>
                        <td style="vertical-align: top;">
                            <textarea ui="type:'TextInput',formname:'sprint_desc'" cols="40" rows="9"></textarea>
                        </td>
                    </tr>
                    <tr>
                        <td align="right" class="inputLabel" style="vertical-align: top;">Index:</td>
                        <td style="vertical-align: top;">
                            <input type="text" size="16" ui="type:'TextInput',formname:'sprint_index'" style="float:left;margin-right:20px;" />
                            <label ui="type:'Checkbox',formname:'sprint_done',value:'yes',checked:''">Done</label>
                        </td>
                    </tr>
                    <tr>
                        <td align="right" class="inputLabel" style="vertical-align: top;">Start/End:</td>
                        <td style="vertical-align: top;">
                            <input type="date" size="8" ui="type:'TextInput',formname:'sprint_start'" /> - 
                            <input type="date" size="8" ui="type:'TextInput',formname:'sprint_finish'" />
                        </td>
                    </tr>
                    <tr>
                        <td align="right" valign="top"> </td>
                        <td height="40" valign="bottom">
                            <button ui="type:'Button',formname:'submit'">提交</button>
                        </td>
                    </tr>
               </table>

                <!-- target: taskboard_addproduct -->
                <style>
                #memberlist,
                #observerlist{ height: 84px;overflow-y: scroll;}
                #memberlist .hui_checkbox,
                #observerlist .hui_checkbox{ min-width: 76px;}
                </style>
                <table>
                    <tr>
                        <td align="right" valign="top"> </td>
                        <td align="left" valign="top" colspan="3"><h3 class="dialog_title">Add Product</h3></td>
                    </tr>
                    <tr>
                        <td align="right" valign="top" width="115">Name:</td>
                        <td>
                            <input type="hidden" ui="type:'TextInput',formname:'product_id'" />
                            <input type="text" size="30" ui="type:'TextInput',formname:'product_name',rule:'required'" />
                        </td>
                        <td rowspan="6" style="vertical-align: top; padding-left:20px;">

                        </td>
                    </tr>
                    <tr>
                        <td align="right" class="inputLabel" style="vertical-align: top;">Description:</td>
                        <td style="vertical-align: top;">
                            <textarea ui="type:'TextInput',formname:'product_desc'" cols="40" rows="7"></textarea>
                        </td>
                    </tr>
                    <tr>
                        <td align="right" valign="top">Keyword :</td>
                        <td>
                            <input type="text" size="13" ui="type:'TextInput',formname:'product_key',rule:'required'" /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Index:
                            <input type="text" size="13" ui="type:'TextInput',formname:'product_index'" />
                        </td>
                    </tr>
                    <tr>
                        <td align="right" valign="top">Member :</td>
                        <td>
                            <div id="memberlist" style="">#{memberlist}</div>
                        </td>
                    </tr>
                    <tr>
                        <td align="right" valign="top">Observer :</td>
                        <td>
                            <div id="observerlist" style="">#{observerlist}</div>
                        </td>
                    </tr>
                    <tr>
                        <td align="right" valign="top"> </td>
                        <td height="40" valign="bottom">
                            <button ui="type:'Button',formname:'submit'">提交</button>
                        </td>
                    </tr>
                    
                </table>

                <!-- target: taskboard_addbacklog -->
                <table>
                    <tr>
                        <td align="right" valign="top"> </td>
                        <td align="left" valign="top" colspan="3"><h3 class="dialog_title">Add Backlog</h3></td>
                    </tr>
                    <tr>
                        <td align="right" valign="top" width="115">Title:</td>
                        <td>
                            <input type="hidden" ui="type:'TextInput',formname:'sprint_id'" />
                            <input type="hidden" ui="type:'TextInput',formname:'backlog_id'" />
                            <input type="text" size="30" ui="type:'TextInput',formname:'backlog_name',rule:'required'" />
                        </td>
                        <td rowspan="6" style="vertical-align: top; padding-left:20px;">

                        </td>
                    </tr>
                    <tr>
                        <td align="right" valign="top">Sprint:</td>
                        <td>
                            <span style="font-weight123:bold;" ui="type:'Label',formname:'sprint_name'"></span>
                        </td>
                        <td rowspan="6" style="vertical-align: top; padding-left:20px;">

                        </td>
                    </tr>
                    <tr>
                        <td align="right" class="inputLabel" style="vertical-align: top;">Description:</td>
                        <td style="vertical-align: top;">
                            <textarea ui="type:'TextInput',formname:'backlog_desc'" cols="40" rows="9"></textarea>
                        </td>
                    </tr>
                    <tr>
                        <td align="right" class="inputLabel" style="vertical-align: top;">Index:</td>
                        <td style="vertical-align: top;">
                            <input type="text" size="16" ui="type:'TextInput',formname:'backlog_index'" />
                        </td>
                    </tr>
                    <tr>
                        <td align="right" valign="top"> </td>
                        <td height="40" valign="bottom">
                            <button ui="type:'Button',formname:'submit'">提交</button>
                        </td>
                    </tr>
               </table>


                <!-- target: taskboard_addtask -->


                <div id="addTaskModal">
                    <table id="addTaskTable">
                        <tr>
                            <td align="right" valign="top"> </td>
                            <td align="left" valign="top"><h3 class="dialog_title">Add Task</h3></td>
                        </tr>
                        <tr>
                            <td align="right" valign="top" width="115">Title:</td>
                            <td>
                                <input type="hidden" ui="type:'TextInput',formname:'task_deleted',value:'0'" />
                                <input type="hidden" ui="type:'TextInput',formname:'product_id'" />
                                <input type="hidden" ui="type:'TextInput',formname:'sprint_id'" />
                                <input type="hidden" ui="type:'TextInput',formname:'backlog_id'" />
                                <input type="hidden" ui="type:'TextInput',formname:'task_id'" />
                                <input type="text" list="occupation" ui="type:'TextInput',formname:'task_name',rule:'required'" style="width: 267px;" />
                                <datalist id="occupation">
                                    <option value="[RD]">
                                    <option value="[FE]">
                                    <option value="[QA]">
                                    <option value="[UED]">
                                    <option value="[IOS]">
                                    <option value="[Android]">
                                    <option value="[PM]">                                    
                                </datalist>
                            </td>
                        </tr>
                        <tr>
                            <td align="right" valign="top">Backlog:</td>
                            <td>
                                <span style="font-weight123:bold;" ui="type:'Label',formname:'backlog_name'"></span>
                            </td>
                        </tr>
                        <tr>
                            <td align="right" class="inputLabel" style="vertical-align: top;">Description:</td>
                            <td style="vertical-align: top;">
                                <textarea ui="type:'TextInput',formname:'task_desc'" cols="40" rows="9" style="width: 288px;"></textarea>
                            </td>
                        </tr>
                        <tr>
                            <td align="right" class="inputLabel">Point Person:</td>
                            <td>
                                <div ui="type:'Dropdown',formname:'task_person',data_value:'uid',data_text:'user_label'" style="width: 288px;"></div>
                            </td>
                        </tr>
                        <tr>
                            <td align="right" class="inputLabel">Status:</td>
                            <td>
                                <div ui="type:'Dropdown',formname:'task_status',options:[{value:\'notstarted\',text:'Not Started'},{value:\'impeded\',text:'Impeded'},{value:\'inprogress\',text:'In Progress'},{value:\'done\',text:'Done'}],size:{width:\'150px\'},default_select:true">
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td align="right" class="inputLabel">Remaining:</td>
                            <td style="vertical-align: top">
                                <table>
                                    <tr>
                                        <td>
                                            <input ui="type:'TextInput',formname:'task_remaining'" size="3" type="text" value="4" /> hours
                                        </td>
                                        <td class="inputLabel" style="padding-left:35px;">Original Estimate:</td>
                                        <td>
                                            <input ui="type:'TextInput',formname:'task_estimate'" size="3" value="4">
                                            </span> hours
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                        <tr>
                            <td align="right" class="inputLabel">Date start:</td>
                            <td>
                                <input type="date" size="18" ui="type:'TextInput',formname:'task_start'" />
                            </td>
                        </tr>
                        <tr style="height: 30px;">
                            <td colspan="2">&nbsp;</td>
                        </tr>
                        <tr>
                            <td align="right" valign="top"> </td>
                            <td height="40" valign="bottom">
                                <button ui="type:'Button',formname:'submit'">提交</button>
                            </td>
                        </tr>
                    </table>

                </div>
            </div>

        </div>
        <div class="page_foot">
            <!--div class="page_container">
                沪ICP备15001838号 上海轩禄商务咨询有限公司 ©2015 版权所有
            </div-->
        </div>
    </div>

    <div id="subject_add" class="subject_test">





    </div>

    <!-- script type="text/javascript" src="http://bpmjs.org/bpm_api/combo??hui_requester@0.0.1,hui_action@0.0.1,hui_panel@0.0.1,hui_table@0.0.1,hui_checkbox@0.0.1,hui_textinput@0.0.1,hui_button@0.0.1,hui_template@0.0.1,hui_checklabel@0.0.1,hui_boxpanel@0.0.1,hui_label@0.0.1,hui_slider@0.0.1,hui_radiobox@0.0.1,hui_dropdown@0.0.1,hui_validator@0.0.1?debug=true"></script -->
    <!-- script type="text/javascript" src="http://bpmjs.org/js/??hui@0.0.1/hui.js,hui_validator@0.0.1/hui_validator.js,hui_util@0.0.1/hui_util.js,hui_dropdown@0.0.1/hui_dropdown.js,hui_control@0.0.1/hui_control.js,hui_radiobox@0.0.1/hui_radiobox.js,hui_checkbox@0.0.1/hui_checkbox.js,hui_slider@0.0.1/hui_slider.js,hui_draggable@0.0.1/hui_draggable.js,hui_label@0.0.1/hui_label.js,hui_boxpanel@0.0.1/hui_boxpanel.js,hui_checklabel@0.0.1/hui_checklabel.js,hui_template@0.0.1/hui_template.js,hui_button@0.0.1/hui_button.js,hui_textinput@0.0.1/hui_textinput.js,hui_table@0.0.1/hui_table.js,hui_panel@0.0.1/hui_panel.js,hui_action@0.0.1/hui_action.js,hui_requester@0.0.1/hui_requester.js?debug=true"></script -->
    <script type="text/javascript" src="src/hui@0.0.1/hui.js"></script>
    <script type="text/javascript" src="src/jquery1.8.3.js"></script>
    <script type="text/javascript" src="src/highcharts.js"></script>   
    <script type="text/javascript" src="src/hui_validator@0.0.1/hui_validator.js"></script>
    <script type="text/javascript" src="src/hui_util@0.0.1/hui_util.js"></script>
    <script type="text/javascript" src="src/hui_dropdown@0.0.1/hui_dropdown.js"></script>
    <script type="text/javascript" src="src/hui_control@0.0.1/hui_control.js"></script>
    <script type="text/javascript" src="src/hui_radiobox@0.0.1/hui_radiobox.js"></script>
    <script type="text/javascript" src="src/hui_checkbox@0.0.1/hui_checkbox.js"></script>
    <script type="text/javascript" src="src/hui_slider@0.0.1/hui_slider.js"></script>
    <script type="text/javascript" src="src/hui_draggable@0.0.1/hui_draggable.js"></script>
    <script type="text/javascript" src="src/hui_label@0.0.1/hui_label.js"></script>
    <script type="text/javascript" src="src/hui_boxpanel@0.0.1/hui_boxpanel.js"></script>
    <script type="text/javascript" src="src/hui_mask@0.0.1/hui_mask.js"></script>
    <script type="text/javascript" src="src/hui_checklabel@0.0.1/hui_checklabel.js"></script>
    <script type="text/javascript" src="src/hui_template@0.0.1/hui_template.js"></script>
    <script type="text/javascript" src="src/hui_button@0.0.1/hui_button.js"></script>
    <script type="text/javascript" src="src/hui_select@0.0.1/hui_select.js"></script>
    <script type="text/javascript" src="src/hui_textinput@0.0.1/hui_textinput.js"></script>
    <script type="text/javascript" src="src/hui_table@0.0.1/hui_table.js"></script>
    <script type="text/javascript" src="src/hui_panel@0.0.1/hui_panel.js"></script>
    <script type="text/javascript" src="src/hui_action@0.0.1/hui_action.js"></script>
    <script type="text/javascript" src="src/hui_requester@0.0.1/hui_requester.js"></script>
    <script type="text/javascript" src="src/hui_taskboard@0.0.1/hui_taskboard.js"></script>
    <script type="text/javascript" src="src/hui_burndown@0.0.1/hui_burndown.js"></script>
    <script type="text/javascript" src="src/hui_memberload@0.0.1/hui_memberload.js"></script>
    <!-- Only for highrchart!!  -->
    <script type="text/javascript" src="src/ext_md5.js             "></script>
    <script type="text/javascript" src="src/underscore.js             "></script>

</body>

</html>